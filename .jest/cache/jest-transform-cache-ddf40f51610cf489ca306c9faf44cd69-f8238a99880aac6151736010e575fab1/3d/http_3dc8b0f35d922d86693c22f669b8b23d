1f41bb258c412159b151615b184f86a7
'use strict';

var utils = require("./../utils");

var settle = require("./../core/settle");

var buildFullPath = require("../core/buildFullPath");

var buildURL = require("./../helpers/buildURL");

var http = require('http');

var https = require('https');

var httpFollow = require('follow-redirects').http;

var httpsFollow = require('follow-redirects').https;

var url = require('url');

var zlib = require('zlib');

var VERSION = require("./../env/data").version;

var createError = require("../core/createError");

var enhanceError = require("../core/enhanceError");

var defaults = require("../defaults");

var Cancel = require("../cancel/Cancel");

var isHttps = /https:?/;

function setProxy(options, proxy, location) {
  options.hostname = proxy.host;
  options.host = proxy.host;
  options.port = proxy.port;
  options.path = location;

  if (proxy.auth) {
    var base64 = Buffer.from(proxy.auth.username + ':' + proxy.auth.password, 'utf8').toString('base64');
    options.headers['Proxy-Authorization'] = 'Basic ' + base64;
  }

  options.beforeRedirect = function beforeRedirect(redirection) {
    redirection.headers.host = redirection.host;
    setProxy(redirection, proxy, redirection.href);
  };
}

module.exports = function httpAdapter(config) {
  return new Promise(function dispatchHttpRequest(resolvePromise, rejectPromise) {
    var onCanceled;

    function done() {
      if (config.cancelToken) {
        config.cancelToken.unsubscribe(onCanceled);
      }

      if (config.signal) {
        config.signal.removeEventListener('abort', onCanceled);
      }
    }

    var resolve = function resolve(value) {
      done();
      resolvePromise(value);
    };

    var reject = function reject(value) {
      done();
      rejectPromise(value);
    };

    var data = config.data;
    var headers = config.headers;
    var headerNames = {};
    Object.keys(headers).forEach(function storeLowerName(name) {
      headerNames[name.toLowerCase()] = name;
    });

    if ('user-agent' in headerNames) {
      if (!headers[headerNames['user-agent']]) {
        delete headers[headerNames['user-agent']];
      }
    } else {
      headers['User-Agent'] = 'axios/' + VERSION;
    }

    if (data && !utils.isStream(data)) {
      if (Buffer.isBuffer(data)) {} else if (utils.isArrayBuffer(data)) {
        data = Buffer.from(new Uint8Array(data));
      } else if (utils.isString(data)) {
        data = Buffer.from(data, 'utf-8');
      } else {
        return reject(createError('Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream', config));
      }

      if (!headerNames['content-length']) {
        headers['Content-Length'] = data.length;
      }
    }

    var auth = undefined;

    if (config.auth) {
      var username = config.auth.username || '';
      var password = config.auth.password || '';
      auth = username + ':' + password;
    }

    var fullPath = buildFullPath(config.baseURL, config.url);
    var parsed = url.parse(fullPath);
    var protocol = parsed.protocol || 'http:';

    if (!auth && parsed.auth) {
      var urlAuth = parsed.auth.split(':');
      var urlUsername = urlAuth[0] || '';
      var urlPassword = urlAuth[1] || '';
      auth = urlUsername + ':' + urlPassword;
    }

    if (auth && headerNames.authorization) {
      delete headers[headerNames.authorization];
    }

    var isHttpsRequest = isHttps.test(protocol);
    var agent = isHttpsRequest ? config.httpsAgent : config.httpAgent;
    var options = {
      path: buildURL(parsed.path, config.params, config.paramsSerializer).replace(/^\?/, ''),
      method: config.method.toUpperCase(),
      headers: headers,
      agent: agent,
      agents: {
        http: config.httpAgent,
        https: config.httpsAgent
      },
      auth: auth
    };

    if (config.socketPath) {
      options.socketPath = config.socketPath;
    } else {
      options.hostname = parsed.hostname;
      options.port = parsed.port;
    }

    var proxy = config.proxy;

    if (!proxy && proxy !== false) {
      var proxyEnv = protocol.slice(0, -1) + '_proxy';
      var proxyUrl = process.env[proxyEnv] || process.env[proxyEnv.toUpperCase()];

      if (proxyUrl) {
        var parsedProxyUrl = url.parse(proxyUrl);
        var noProxyEnv = process.env.no_proxy || process.env.NO_PROXY;
        var shouldProxy = true;

        if (noProxyEnv) {
          var noProxy = noProxyEnv.split(',').map(function trim(s) {
            return s.trim();
          });
          shouldProxy = !noProxy.some(function proxyMatch(proxyElement) {
            if (!proxyElement) {
              return false;
            }

            if (proxyElement === '*') {
              return true;
            }

            if (proxyElement[0] === '.' && parsed.hostname.substr(parsed.hostname.length - proxyElement.length) === proxyElement) {
              return true;
            }

            return parsed.hostname === proxyElement;
          });
        }

        if (shouldProxy) {
          proxy = {
            host: parsedProxyUrl.hostname,
            port: parsedProxyUrl.port,
            protocol: parsedProxyUrl.protocol
          };

          if (parsedProxyUrl.auth) {
            var proxyUrlAuth = parsedProxyUrl.auth.split(':');
            proxy.auth = {
              username: proxyUrlAuth[0],
              password: proxyUrlAuth[1]
            };
          }
        }
      }
    }

    if (proxy) {
      options.headers.host = parsed.hostname + (parsed.port ? ':' + parsed.port : '');
      setProxy(options, proxy, protocol + '//' + parsed.hostname + (parsed.port ? ':' + parsed.port : '') + options.path);
    }

    var transport;
    var isHttpsProxy = isHttpsRequest && (proxy ? isHttps.test(proxy.protocol) : true);

    if (config.transport) {
      transport = config.transport;
    } else if (config.maxRedirects === 0) {
      transport = isHttpsProxy ? https : http;
    } else {
      if (config.maxRedirects) {
        options.maxRedirects = config.maxRedirects;
      }

      transport = isHttpsProxy ? httpsFollow : httpFollow;
    }

    if (config.maxBodyLength > -1) {
      options.maxBodyLength = config.maxBodyLength;
    }

    if (config.insecureHTTPParser) {
      options.insecureHTTPParser = config.insecureHTTPParser;
    }

    var req = transport.request(options, function handleResponse(res) {
      if (req.aborted) return;
      var stream = res;
      var lastRequest = res.req || req;

      if (res.statusCode !== 204 && lastRequest.method !== 'HEAD' && config.decompress !== false) {
        switch (res.headers['content-encoding']) {
          case 'gzip':
          case 'compress':
          case 'deflate':
            stream = stream.pipe(zlib.createUnzip());
            delete res.headers['content-encoding'];
            break;
        }
      }

      var response = {
        status: res.statusCode,
        statusText: res.statusMessage,
        headers: res.headers,
        config: config,
        request: lastRequest
      };

      if (config.responseType === 'stream') {
        response.data = stream;
        settle(resolve, reject, response);
      } else {
        var responseBuffer = [];
        var totalResponseBytes = 0;
        stream.on('data', function handleStreamData(chunk) {
          responseBuffer.push(chunk);
          totalResponseBytes += chunk.length;

          if (config.maxContentLength > -1 && totalResponseBytes > config.maxContentLength) {
            stream.destroy();
            reject(createError('maxContentLength size of ' + config.maxContentLength + ' exceeded', config, null, lastRequest));
          }
        });
        stream.on('error', function handleStreamError(err) {
          if (req.aborted) return;
          reject(enhanceError(err, config, null, lastRequest));
        });
        stream.on('end', function handleStreamEnd() {
          var responseData = Buffer.concat(responseBuffer);

          if (config.responseType !== 'arraybuffer') {
            responseData = responseData.toString(config.responseEncoding);

            if (!config.responseEncoding || config.responseEncoding === 'utf8') {
              responseData = utils.stripBOM(responseData);
            }
          }

          response.data = responseData;
          settle(resolve, reject, response);
        });
      }
    });
    req.on('error', function handleRequestError(err) {
      if (req.aborted && err.code !== 'ERR_FR_TOO_MANY_REDIRECTS') return;
      reject(enhanceError(err, config, null, req));
    });

    if (config.timeout) {
      var timeout = parseInt(config.timeout, 10);

      if (isNaN(timeout)) {
        reject(createError('error trying to parse `config.timeout` to int', config, 'ERR_PARSE_TIMEOUT', req));
        return;
      }

      req.setTimeout(timeout, function handleRequestTimeout() {
        req.abort();
        var transitional = config.transitional || defaults.transitional;
        reject(createError('timeout of ' + timeout + 'ms exceeded', config, transitional.clarifyTimeoutError ? 'ETIMEDOUT' : 'ECONNABORTED', req));
      });
    }

    if (config.cancelToken || config.signal) {
      onCanceled = function onCanceled(cancel) {
        if (req.aborted) return;
        req.abort();
        reject(!cancel || cancel && cancel.type ? new Cancel('canceled') : cancel);
      };

      config.cancelToken && config.cancelToken.subscribe(onCanceled);

      if (config.signal) {
        config.signal.aborted ? onCanceled() : config.signal.addEventListener('abort', onCanceled);
      }
    }

    if (utils.isStream(data)) {
      data.on('error', function handleStreamError(err) {
        reject(enhanceError(err, config, null, req));
      }).pipe(req);
    } else {
      req.end(data);
    }
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHAuanMiXSwibmFtZXMiOlsidXRpbHMiLCJyZXF1aXJlIiwic2V0dGxlIiwiYnVpbGRGdWxsUGF0aCIsImJ1aWxkVVJMIiwiaHR0cCIsImh0dHBzIiwiaHR0cEZvbGxvdyIsImh0dHBzRm9sbG93IiwidXJsIiwiemxpYiIsIlZFUlNJT04iLCJ2ZXJzaW9uIiwiY3JlYXRlRXJyb3IiLCJlbmhhbmNlRXJyb3IiLCJkZWZhdWx0cyIsIkNhbmNlbCIsImlzSHR0cHMiLCJzZXRQcm94eSIsIm9wdGlvbnMiLCJwcm94eSIsImxvY2F0aW9uIiwiaG9zdG5hbWUiLCJob3N0IiwicG9ydCIsInBhdGgiLCJhdXRoIiwiYmFzZTY0IiwiQnVmZmVyIiwiZnJvbSIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJ0b1N0cmluZyIsImhlYWRlcnMiLCJiZWZvcmVSZWRpcmVjdCIsInJlZGlyZWN0aW9uIiwiaHJlZiIsIm1vZHVsZSIsImV4cG9ydHMiLCJodHRwQWRhcHRlciIsImNvbmZpZyIsIlByb21pc2UiLCJkaXNwYXRjaEh0dHBSZXF1ZXN0IiwicmVzb2x2ZVByb21pc2UiLCJyZWplY3RQcm9taXNlIiwib25DYW5jZWxlZCIsImRvbmUiLCJjYW5jZWxUb2tlbiIsInVuc3Vic2NyaWJlIiwic2lnbmFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlc29sdmUiLCJ2YWx1ZSIsInJlamVjdCIsImRhdGEiLCJoZWFkZXJOYW1lcyIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwic3RvcmVMb3dlck5hbWUiLCJuYW1lIiwidG9Mb3dlckNhc2UiLCJpc1N0cmVhbSIsImlzQnVmZmVyIiwiaXNBcnJheUJ1ZmZlciIsIlVpbnQ4QXJyYXkiLCJpc1N0cmluZyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImZ1bGxQYXRoIiwiYmFzZVVSTCIsInBhcnNlZCIsInBhcnNlIiwicHJvdG9jb2wiLCJ1cmxBdXRoIiwic3BsaXQiLCJ1cmxVc2VybmFtZSIsInVybFBhc3N3b3JkIiwiYXV0aG9yaXphdGlvbiIsImlzSHR0cHNSZXF1ZXN0IiwidGVzdCIsImFnZW50IiwiaHR0cHNBZ2VudCIsImh0dHBBZ2VudCIsInBhcmFtcyIsInBhcmFtc1NlcmlhbGl6ZXIiLCJyZXBsYWNlIiwibWV0aG9kIiwidG9VcHBlckNhc2UiLCJhZ2VudHMiLCJzb2NrZXRQYXRoIiwicHJveHlFbnYiLCJzbGljZSIsInByb3h5VXJsIiwicHJvY2VzcyIsImVudiIsInBhcnNlZFByb3h5VXJsIiwibm9Qcm94eUVudiIsIm5vX3Byb3h5IiwiTk9fUFJPWFkiLCJzaG91bGRQcm94eSIsIm5vUHJveHkiLCJtYXAiLCJ0cmltIiwicyIsInNvbWUiLCJwcm94eU1hdGNoIiwicHJveHlFbGVtZW50Iiwic3Vic3RyIiwicHJveHlVcmxBdXRoIiwidHJhbnNwb3J0IiwiaXNIdHRwc1Byb3h5IiwibWF4UmVkaXJlY3RzIiwibWF4Qm9keUxlbmd0aCIsImluc2VjdXJlSFRUUFBhcnNlciIsInJlcSIsInJlcXVlc3QiLCJoYW5kbGVSZXNwb25zZSIsInJlcyIsImFib3J0ZWQiLCJzdHJlYW0iLCJsYXN0UmVxdWVzdCIsInN0YXR1c0NvZGUiLCJkZWNvbXByZXNzIiwicGlwZSIsImNyZWF0ZVVuemlwIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJzdGF0dXNUZXh0Iiwic3RhdHVzTWVzc2FnZSIsInJlc3BvbnNlVHlwZSIsInJlc3BvbnNlQnVmZmVyIiwidG90YWxSZXNwb25zZUJ5dGVzIiwib24iLCJoYW5kbGVTdHJlYW1EYXRhIiwiY2h1bmsiLCJwdXNoIiwibWF4Q29udGVudExlbmd0aCIsImRlc3Ryb3kiLCJoYW5kbGVTdHJlYW1FcnJvciIsImVyciIsImhhbmRsZVN0cmVhbUVuZCIsInJlc3BvbnNlRGF0YSIsImNvbmNhdCIsInJlc3BvbnNlRW5jb2RpbmciLCJzdHJpcEJPTSIsImhhbmRsZVJlcXVlc3RFcnJvciIsImNvZGUiLCJ0aW1lb3V0IiwicGFyc2VJbnQiLCJpc05hTiIsInNldFRpbWVvdXQiLCJoYW5kbGVSZXF1ZXN0VGltZW91dCIsImFib3J0IiwidHJhbnNpdGlvbmFsIiwiY2xhcmlmeVRpbWVvdXRFcnJvciIsImNhbmNlbCIsInR5cGUiLCJzdWJzY3JpYmUiLCJhZGRFdmVudExpc3RlbmVyIiwiZW5kIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFJQSxLQUFLLEdBQUdDLE9BQU8sY0FBbkI7O0FBQ0EsSUFBSUMsTUFBTSxHQUFHRCxPQUFPLG9CQUFwQjs7QUFDQSxJQUFJRSxhQUFhLEdBQUdGLE9BQU8seUJBQTNCOztBQUNBLElBQUlHLFFBQVEsR0FBR0gsT0FBTyx5QkFBdEI7O0FBQ0EsSUFBSUksSUFBSSxHQUFHSixPQUFPLENBQUMsTUFBRCxDQUFsQjs7QUFDQSxJQUFJSyxLQUFLLEdBQUdMLE9BQU8sQ0FBQyxPQUFELENBQW5COztBQUNBLElBQUlNLFVBQVUsR0FBR04sT0FBTyxDQUFDLGtCQUFELENBQVAsQ0FBNEJJLElBQTdDOztBQUNBLElBQUlHLFdBQVcsR0FBR1AsT0FBTyxDQUFDLGtCQUFELENBQVAsQ0FBNEJLLEtBQTlDOztBQUNBLElBQUlHLEdBQUcsR0FBR1IsT0FBTyxDQUFDLEtBQUQsQ0FBakI7O0FBQ0EsSUFBSVMsSUFBSSxHQUFHVCxPQUFPLENBQUMsTUFBRCxDQUFsQjs7QUFDQSxJQUFJVSxPQUFPLEdBQUdWLE9BQU8saUJBQVAsQ0FBeUJXLE9BQXZDOztBQUNBLElBQUlDLFdBQVcsR0FBR1osT0FBTyx1QkFBekI7O0FBQ0EsSUFBSWEsWUFBWSxHQUFHYixPQUFPLHdCQUExQjs7QUFDQSxJQUFJYyxRQUFRLEdBQUdkLE9BQU8sZUFBdEI7O0FBQ0EsSUFBSWUsTUFBTSxHQUFHZixPQUFPLG9CQUFwQjs7QUFFQSxJQUFJZ0IsT0FBTyxHQUFHLFNBQWQ7O0FBUUEsU0FBU0MsUUFBVCxDQUFrQkMsT0FBbEIsRUFBMkJDLEtBQTNCLEVBQWtDQyxRQUFsQyxFQUE0QztBQUMxQ0YsRUFBQUEsT0FBTyxDQUFDRyxRQUFSLEdBQW1CRixLQUFLLENBQUNHLElBQXpCO0FBQ0FKLEVBQUFBLE9BQU8sQ0FB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Q0wsTUFBTSxDQUFDUyxNQUFQLENBQWM4RyxnQkFBZCxDQUErQixPQUEvQixFQUF3Q2xILFVBQXhDLENBQXZDO0FBQ0Q7QUFDRjs7QUFJRCxRQUFJN0MsS0FBSyxDQUFDOEQsUUFBTixDQUFlUixJQUFmLENBQUosRUFBMEI7QUFDeEJBLE1BQUFBLElBQUksQ0FBQytFLEVBQUwsQ0FBUSxPQUFSLEVBQWlCLFNBQVNNLGlCQUFULENBQTJCQyxHQUEzQixFQUFnQztBQUMvQ3ZGLFFBQUFBLE1BQU0sQ0FBQ3ZDLFlBQVksQ0FBQzhILEdBQUQsRUFBTXBHLE1BQU4sRUFBYyxJQUFkLEVBQW9CMkUsR0FBcEIsQ0FBYixDQUFOO0FBQ0QsT0FGRCxFQUVHUyxJQUZILENBRVFULEdBRlI7QUFHRCxLQUpELE1BSU87QUFDTEEsTUFBQUEsR0FBRyxDQUFDNkMsR0FBSixDQUFRMUcsSUFBUjtBQUNEO0FBQ0YsR0ExVE0sQ0FBUDtBQTJURCxDQTVURCIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi8uLi91dGlscycpO1xudmFyIHNldHRsZSA9IHJlcXVpcmUoJy4vLi4vY29yZS9zZXR0bGUnKTtcbnZhciBidWlsZEZ1bGxQYXRoID0gcmVxdWlyZSgnLi4vY29yZS9idWlsZEZ1bGxQYXRoJyk7XG52YXIgYnVpbGRVUkwgPSByZXF1aXJlKCcuLy4uL2hlbHBlcnMvYnVpbGRVUkwnKTtcbnZhciBodHRwID0gcmVxdWlyZSgnaHR0cCcpO1xudmFyIGh0dHBzID0gcmVxdWlyZSgnaHR0cHMnKTtcbnZhciBodHRwRm9sbG93ID0gcmVxdWlyZSgnZm9sbG93LXJlZGlyZWN0cycpLmh0dHA7XG52YXIgaHR0cHNGb2xsb3cgPSByZXF1aXJlKCdmb2xsb3ctcmVkaXJlY3RzJykuaHR0cHM7XG52YXIgdXJsID0gcmVxdWlyZSgndXJsJyk7XG52YXIgemxpYiA9IHJlcXVpcmUoJ3psaWInKTtcbnZhciBWRVJTSU9OID0gcmVxdWlyZSgnLi8uLi9lbnYvZGF0YScpLnZlcnNpb247XG52YXIgY3JlYXRlRXJyb3IgPSByZXF1aXJlKCcuLi9jb3JlL2NyZWF0ZUVycm9yJyk7XG52YXIgZW5oYW5jZUVycm9yID0gcmVxdWlyZSgnLi4vY29yZS9lbmhhbmNlRXJyb3InKTtcbnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoJy4uL2RlZmF1bHRzJyk7XG52YXIgQ2FuY2VsID0gcmVxdWlyZSgnLi4vY2FuY2VsL0NhbmNlbCcpO1xuXG52YXIgaXNIdHRwcyA9IC9odHRwczo/LztcblxuLyoqXG4gKlxuICogQHBhcmFtIHtodHRwLkNsaWVudFJlcXVlc3RBcmdzfSBvcHRpb25zXG4gKiBAcGFyYW0ge0F4aW9zUHJveHlDb25maWd9IHByb3h5XG4gKiBAcGFyYW0ge3N0cmluZ30gbG9jYXRpb25cbiAqL1xuZnVuY3Rpb24gc2V0UHJveHkob3B0aW9ucywgcHJveHksIGxvY2F0aW9uKSB7XG4gIG9wdGlvbnMuaG9zdG5hbWUgPSBwcm94eS5ob3N0O1xuICBvcHRpb25zLmhvc3QgPSBwcm94eS5ob3N0O1xuICBvcHRpb25zLnBvcnQgPSBwcm94eS5wb3J0O1xuICBvcHRpb25zLnBhdGggPSBsb2NhdGlvbjtcblxuICAvLyBCYXNpYyBwcm94eSBhdXRob3JpemF0aW9uXG4gIGlmIChwcm94eS5hdXRoKSB7XG4gICAgdmFyIGJhc2U2NCA9IEJ1ZmZlci5mcm9tKHByb3h5LmF1dGgudXNlcm5hbWUgKyAnOicgKyBwcm94eS5hdXRoLnBhc3N3b3JkLCAndXRmOCcpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICBvcHRpb25zLmhlYWRlcnNbJ1Byb3h5LUF1dGhvcml6YXRpb24nXSA9ICdCYXNpYyAnICsgYmFzZTY0O1xuICB9XG5cbiAgLy8gSWYgYSBwcm94eSBpcyB1c2VkLCBhbnkgcmVkaXJlY3RzIG11c3QgYWxzbyBwYXNzIHRocm91Z2ggdGhlIHByb3h5XG4gIG9wdGlvbnMuYmVmb3JlUmVkaXJlY3QgPSBmdW5jdGlvbiBiZWZvcmVSZWRpcmVjdChyZWRpcmVjdGlvbikge1xuICAgIHJlZGlyZWN0aW9uLmhlYWRlcnMuaG9zdCA9IHJlZGlyZWN0aW9uLmhvc3Q7XG4gICAgc2V0UHJveHkocmVkaXJlY3Rpb24sIHByb3h5LCByZWRpcmVjdGlvbi5ocmVmKTtcbiAgfTtcbn1cblxuLyplc2xpbnQgY29uc2lzdGVudC1yZXR1cm46MCovXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGh0dHBBZGFwdGVyKGNvbmZpZykge1xuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gZGlzcGF0Y2hIdHRwUmVxdWVzdChyZXNvbHZlUHJvbWlzZSwgcmVqZWN0UHJvbWlzZSkge1xuICAgIHZhciBvbkNhbmNlbGVkO1xuICAgIGZ1bmN0aW9uIGRvbmUoKSB7XG4gICAgICBpZiAoY29uZmlnLmNhbmNlbFRva2VuKSB7XG4gICAgICAgIGNvbmZpZy5jYW5jZWxUb2tlbi51bnN1YnNjcmliZShvbkNhbmNlbGVkKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNvbmZpZy5zaWduYWwpIHtcbiAgICAgICAgY29uZmlnLnNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uQ2FuY2VsZWQpO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgcmVzb2x2ZSA9IGZ1bmN0aW9uIHJlc29sdmUodmFsdWUpIHtcbiAgICAgIGRvbmUoKTtcbiAgICAgIHJlc29sdmVQcm9taXNlKHZhbHVlKTtcbiAgICB9O1xuICAgIHZhciByZWplY3QgPSBmdW5jdGlvbiByZWplY3QodmFsdWUpIHtcbiAgICAgIGRvbmUoKTtcbiAgICAgIHJlamVjdFByb21pc2UodmFsdWUpO1xuICAgIH07XG4gICAgdmFyIGRhdGEgPSBjb25maWcuZGF0YTtcbiAgICB2YXIgaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzO1xuICAgIHZhciBoZWFkZXJOYW1lcyA9IHt9O1xuXG4gICAgT2JqZWN0LmtleXMoaGVhZGVycykuZm9yRWFjaChmdW5jdGlvbiBzdG9yZUxvd2VyTmFtZShuYW1lKSB7XG4gICAgICBoZWFkZXJOYW1lc1tuYW1lLnRvTG93ZXJDYXNlKCldID0gbmFtZTtcbiAgICB9KTtcblxuICAgIC8vIFNldCBVc2VyLUFnZW50IChyZXF1aXJlZCBieSBzb21lIHNlcnZlcnMpXG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9heGlvcy9heGlvcy9pc3N1ZXMvNjlcbiAgICBpZiAoJ3VzZXItYWdlbnQnIGluIGhlYWRlck5hbWVzKSB7XG4gICAgICAvLyBVc2VyLUFnZW50IGlzIHNwZWNpZmllZDsgaGFuZGxlIGNhc2Ugd2hlcmUgbm8gVUEgaGVhZGVyIGlzIGRlc2lyZWRcbiAgICAgIGlmICghaGVhZGVyc1toZWFkZXJOYW1lc1sndXNlci1hZ2VudCddXSkge1xuICAgICAgICBkZWxldGUgaGVhZGVyc1toZWFkZXJOYW1lc1sndXNlci1hZ2VudCddXTtcbiAgICAgIH1cbiAgICAgIC8vIE90aGVyd2lzZSwgdXNlIHNwZWNpZmllZCB2YWx1ZVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBPbmx5IHNldCBoZWFkZXIgaWYgaXQgaGFzbid0IGJlZW4gc2V0IGluIGNvbmZpZ1xuICAgICAgaGVhZGVyc1snVXNlci1BZ2VudCddID0gJ2F4aW9zLycgKyBWRVJTSU9OO1xuICAgIH1cblxuICAgIGlmIChkYXRhICYmICF1dGlscy5pc1N0cmVhbShkYXRhKSkge1xuICAgICAgaWYgKEJ1ZmZlci5pc0J1ZmZlcihkYXRhKSkge1xuICAgICAgICAvLyBOb3RoaW5nIHRvIGRvLi4uXG4gICAgICB9IGVsc2UgaWYgKHV0aWxzLmlzQXJyYXlCdWZmZXIoZGF0YSkpIHtcbiAgICAgICAgZGF0YSA9IEJ1ZmZlci5mcm9tKG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICAgIH0gZWxzZSBpZiAodXRpbHMuaXNTdHJpbmcoZGF0YSkpIHtcbiAgICAgICAgZGF0YSA9IEJ1ZmZlci5mcm9tKGRhdGEsICd1dGYtOCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChjcmVhdGVFcnJvcihcbiAgICAgICAgICAnRGF0YSBhZnRlciB0cmFuc2Zvcm1hdGlvbiBtdXN0IGJlIGEgc3RyaW5nLCBhbiBBcnJheUJ1ZmZlciwgYSBCdWZmZXIsIG9yIGEgU3RyZWFtJyxcbiAgICAgICAgICBjb25maWdcbiAgICAgICAgKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBDb250ZW50LUxlbmd0aCBoZWFkZXIgaWYgZGF0YSBleGlzdHNcbiAgICAgIGlmICghaGVhZGVyTmFtZXNbJ2NvbnRlbnQtbGVuZ3RoJ10pIHtcbiAgICAgICAgaGVhZGVyc1snQ29udGVudC1MZW5ndGgnXSA9IGRhdGEubGVuZ3RoO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEhUVFAgYmFzaWMgYXV0aGVudGljYXRpb25cbiAgICB2YXIgYXV0aCA9IHVuZGVmaW5lZDtcbiAgICBpZiAoY29uZmlnLmF1dGgpIHtcbiAgICAgIHZhciB1c2VybmFtZSA9IGNvbmZpZy5hdXRoLnVzZXJuYW1lIHx8ICcnO1xuICAgICAgdmFyIHBhc3N3b3JkID0gY29uZmlnLmF1dGgucGFzc3dvcmQgfHwgJyc7XG4gICAgICBhdXRoID0gdXNlcm5hbWUgKyAnOicgKyBwYXNzd29yZDtcbiAgICB9XG5cbiAgICAvLyBQYXJzZSB1cmxcbiAgICB2YXIgZnVsbFBhdGggPSBidWlsZEZ1bGxQYXRoKGNvbmZpZy5iYXNlVVJMLCBjb25maWcudXJsKTtcbiAgICB2YXIgcGFyc2VkID0gdXJsLnBhcnNlKGZ1bGxQYXRoKTtcbiAgICB2YXIgcHJvdG9jb2wgPSBwYXJzZWQucHJvdG9jb2wgfHwgJ2h0dHA6JztcblxuICAgIGlmICghYXV0aCAmJiBwYXJzZWQuYXV0aCkge1xuICAgICAgdmFyIHVybEF1dGggPSBwYXJzZWQuYXV0aC5zcGxpdCgnOicpO1xuICAgICAgdmFyIHVybFVzZXJuYW1lID0gdXJsQXV0aFswXSB8fCAnJztcbiAgICAgIHZhciB1cmxQYXNzd29yZCA9IHVybEF1dGhbMV0gfHwgJyc7XG4gICAgICBhdXRoID0gdXJsVXNlcm5hbWUgKyAnOicgKyB1cmxQYXNzd29yZDtcbiAgICB9XG5cbiAgICBpZiAoYXV0aCAmJiBoZWFkZXJOYW1lcy5hdXRob3JpemF0aW9uKSB7XG4gICAgICBkZWxldGUgaGVhZGVyc1toZWFkZXJOYW1lcy5hdXRob3JpemF0aW9uXTtcbiAgICB9XG5cbiAgICB2YXIgaXNIdHRwc1JlcXVlc3QgPSBpc0h0dHBzLnRlc3QocHJvdG9jb2wpO1xuICAgIHZhciBhZ2VudCA9IGlzSHR0cHNSZXF1ZXN0ID8gY29uZmlnLmh0dHBzQWdlbnQgOiBjb25maWcuaHR0cEFnZW50O1xuXG4gICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICBwYXRoOiBidWlsZFVSTChwYXJzZWQucGF0aCwgY29uZmlnLnBhcmFtcywgY29uZmlnLnBhcmFtc1NlcmlhbGl6ZXIpLnJlcGxhY2UoL15cXD8vLCAnJyksXG4gICAgICBtZXRob2Q6IGNvbmZpZy5tZXRob2QudG9VcHBlckNhc2UoKSxcbiAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICBhZ2VudDogYWdlbnQsXG4gICAgICBhZ2VudHM6IHsgaHR0cDogY29uZmlnLmh0dHBBZ2VudCwgaHR0cHM6IGNvbmZpZy5odHRwc0FnZW50IH0sXG4gICAgICBhdXRoOiBhdXRoXG4gICAgfTtcblxuICAgIGlmIChjb25maWcuc29ja2V0UGF0aCkge1xuICAgICAgb3B0aW9ucy5zb2NrZXRQYXRoID0gY29uZmlnLnNvY2tldFBhdGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9wdGlvbnMuaG9zdG5hbWUgPSBwYXJzZWQuaG9zdG5hbWU7XG4gICAgICBvcHRpb25zLnBvcnQgPSBwYXJzZWQucG9ydDtcbiAgICB9XG5cbiAgICB2YXIgcHJveHkgPSBjb25maWcucHJveHk7XG4gICAgaWYgKCFwcm94eSAmJiBwcm94eSAhPT0gZmFsc2UpIHtcbiAgICAgIHZhciBwcm94eUVudiA9IHByb3RvY29sLnNsaWNlKDAsIC0xKSArICdfcHJveHknO1xuICAgICAgdmFyIHByb3h5VXJsID0gcHJvY2Vzcy5lbnZbcHJveHlFbnZdIHx8IHByb2Nlc3MuZW52W3Byb3h5RW52LnRvVXBwZXJDYXNlKCldO1xuICAgICAgaWYgKHByb3h5VXJsKSB7XG4gICAgICAgIHZhciBwYXJzZWRQcm94eVVybCA9IHVybC5wYXJzZShwcm94eVVybCk7XG4gICAgICAgIHZhciBub1Byb3h5RW52ID0gcHJvY2Vzcy5lbnYubm9fcHJveHkgfHwgcHJvY2Vzcy5lbnYuTk9fUFJPWFk7XG4gICAgICAgIHZhciBzaG91bGRQcm94eSA9IHRydWU7XG5cbiAgICAgICAgaWYgKG5vUHJveHlFbnYpIHtcbiAgICAgICAgICB2YXIgbm9Qcm94eSA9IG5vUHJveHlFbnYuc3BsaXQoJywnKS5tYXAoZnVuY3Rpb24gdHJpbShzKSB7XG4gICAgICAgICAgICByZXR1cm4gcy50cmltKCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBzaG91bGRQcm94eSA9ICFub1Byb3h5LnNvbWUoZnVuY3Rpb24gcHJveHlNYXRjaChwcm94eUVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmICghcHJveHlFbGVtZW50KSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwcm94eUVsZW1lbnQgPT09ICcqJykge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwcm94eUVsZW1lbnRbMF0gPT09ICcuJyAmJlxuICAgICAgICAgICAgICAgIHBhcnNlZC5ob3N0bmFtZS5zdWJzdHIocGFyc2VkLmhvc3RuYW1lLmxlbmd0aCAtIHByb3h5RWxlbWVudC5sZW5ndGgpID09PSBwcm94eUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBwYXJzZWQuaG9zdG5hbWUgPT09IHByb3h5RWxlbWVudDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzaG91bGRQcm94eSkge1xuICAgICAgICAgIHByb3h5ID0ge1xuICAgICAgICAgICAgaG9zdDogcGFyc2VkUHJveHlVcmwuaG9zdG5hbWUsXG4gICAgICAgICAgICBwb3J0OiBwYXJzZWRQcm94eVVybC5wb3J0LFxuICAgICAgICAgICAgcHJvdG9jb2w6IHBhcnNlZFByb3h5VXJsLnByb3RvY29sXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGlmIChwYXJzZWRQcm94eVVybC5hdXRoKSB7XG4gICAgICAgICAgICB2YXIgcHJveHlVcmxBdXRoID0gcGFyc2VkUHJveHlVcmwuYXV0aC5zcGxpdCgnOicpO1xuICAgICAgICAgICAgcHJveHkuYXV0aCA9IHtcbiAgICAgICAgICAgICAgdXNlcm5hbWU6IHByb3h5VXJsQXV0aFswXSxcbiAgICAgICAgICAgICAgcGFzc3dvcmQ6IHByb3h5VXJsQXV0aFsxXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocHJveHkpIHtcbiAgICAgIG9wdGlvbnMuaGVhZGVycy5ob3N0ID0gcGFyc2VkLmhvc3RuYW1lICsgKHBhcnNlZC5wb3J0ID8gJzonICsgcGFyc2VkLnBvcnQgOiAnJyk7XG4gICAgICBzZXRQcm94eShvcHRpb25zLCBwcm94eSwgcHJvdG9jb2wgKyAnLy8nICsgcGFyc2VkLmhvc3RuYW1lICsgKHBhcnNlZC5wb3J0ID8gJzonICsgcGFyc2VkLnBvcnQgOiAnJykgKyBvcHRpb25zLnBhdGgpO1xuICAgIH1cblxuICAgIHZhciB0cmFuc3BvcnQ7XG4gICAgdmFyIGlzSHR0cHNQcm94eSA9IGlzSHR0cHNSZXF1ZXN0ICYmIChwcm94eSA/IGlzSHR0cHMudGVzdChwcm94eS5wcm90b2NvbCkgOiB0cnVlKTtcbiAgICBpZiAoY29uZmlnLnRyYW5zcG9ydCkge1xuICAgICAgdHJhbnNwb3J0ID0gY29uZmlnLnRyYW5zcG9ydDtcbiAgICB9IGVsc2UgaWYgKGNvbmZpZy5tYXhSZWRpcmVjdHMgPT09IDApIHtcbiAgICAgIHRyYW5zcG9ydCA9IGlzSHR0cHNQcm94eSA/IGh0dHBzIDogaHR0cDtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNvbmZpZy5tYXhSZWRpcmVjdHMpIHtcbiAgICAgICAgb3B0aW9ucy5tYXhSZWRpcmVjdHMgPSBjb25maWcubWF4UmVkaXJlY3RzO1xuICAgICAgfVxuICAgICAgdHJhbnNwb3J0ID0gaXNIdHRwc1Byb3h5ID8gaHR0cHNGb2xsb3cgOiBodHRwRm9sbG93O1xuICAgIH1cblxuICAgIGlmIChjb25maWcubWF4Qm9keUxlbmd0aCA+IC0xKSB7XG4gICAgICBvcHRpb25zLm1heEJvZHlMZW5ndGggPSBjb25maWcubWF4Qm9keUxlbmd0aDtcbiAgICB9XG5cbiAgICBpZiAoY29uZmlnLmluc2VjdXJlSFRUUFBhcnNlcikge1xuICAgICAgb3B0aW9ucy5pbnNlY3VyZUhUVFBQYXJzZXIgPSBjb25maWcuaW5zZWN1cmVIVFRQUGFyc2VyO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0aGUgcmVxdWVzdFxuICAgIHZhciByZXEgPSB0cmFuc3BvcnQucmVxdWVzdChvcHRpb25zLCBmdW5jdGlvbiBoYW5kbGVSZXNwb25zZShyZXMpIHtcbiAgICAgIGlmIChyZXEuYWJvcnRlZCkgcmV0dXJuO1xuXG4gICAgICAvLyB1bmNvbXByZXNzIHRoZSByZXNwb25zZSBib2R5IHRyYW5zcGFyZW50bHkgaWYgcmVxdWlyZWRcbiAgICAgIHZhciBzdHJlYW0gPSByZXM7XG5cbiAgICAgIC8vIHJldHVybiB0aGUgbGFzdCByZXF1ZXN0IGluIGNhc2Ugb2YgcmVkaXJlY3RzXG4gICAgICB2YXIgbGFzdFJlcXVlc3QgPSByZXMucmVxIHx8IHJlcTtcblxuXG4gICAgICAvLyBpZiBubyBjb250ZW50LCBpcyBIRUFEIHJlcXVlc3Qgb3IgZGVjb21wcmVzcyBkaXNhYmxlZCB3ZSBzaG91bGQgbm90IGRlY29tcHJlc3NcbiAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSAhPT0gMjA0ICYmIGxhc3RSZXF1ZXN0Lm1ldGhvZCAhPT0gJ0hFQUQnICYmIGNvbmZpZy5kZWNvbXByZXNzICE9PSBmYWxzZSkge1xuICAgICAgICBzd2l0Y2ggKHJlcy5oZWFkZXJzWydjb250ZW50LWVuY29kaW5nJ10pIHtcbiAgICAgICAgLyplc2xpbnQgZGVmYXVsdC1jYXNlOjAqL1xuICAgICAgICBjYXNlICdnemlwJzpcbiAgICAgICAgY2FzZSAnY29tcHJlc3MnOlxuICAgICAgICBjYXNlICdkZWZsYXRlJzpcbiAgICAgICAgLy8gYWRkIHRoZSB1bnppcHBlciB0byB0aGUgYm9keSBzdHJlYW0gcHJvY2Vzc2luZyBwaXBlbGluZVxuICAgICAgICAgIHN0cmVhbSA9IHN0cmVhbS5waXBlKHpsaWIuY3JlYXRlVW56aXAoKSk7XG5cbiAgICAgICAgICAvLyByZW1vdmUgdGhlIGNvbnRlbnQtZW5jb2RpbmcgaW4gb3JkZXIgdG8gbm90IGNvbmZ1c2UgZG93bnN0cmVhbSBvcGVyYXRpb25zXG4gICAgICAgICAgZGVsZXRlIHJlcy5oZWFkZXJzWydjb250ZW50LWVuY29kaW5nJ107XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIHJlc3BvbnNlID0ge1xuICAgICAgICBzdGF0dXM6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICBzdGF0dXNUZXh0OiByZXMuc3RhdHVzTWVzc2FnZSxcbiAgICAgICAgaGVhZGVyczogcmVzLmhlYWRlcnMsXG4gICAgICAgIGNvbmZpZzogY29uZmlnLFxuICAgICAgICByZXF1ZXN0OiBsYXN0UmVxdWVzdFxuICAgICAgfTtcblxuICAgICAgaWYgKGNvbmZpZy5yZXNwb25zZVR5cGUgPT09ICdzdHJlYW0nKSB7XG4gICAgICAgIHJlc3BvbnNlLmRhdGEgPSBzdHJlYW07XG4gICAgICAgIHNldHRsZShyZXNvbHZlLCByZWplY3QsIHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciByZXNwb25zZUJ1ZmZlciA9IFtdO1xuICAgICAgICB2YXIgdG90YWxSZXNwb25zZUJ5dGVzID0gMDtcbiAgICAgICAgc3RyZWFtLm9uKCdkYXRhJywgZnVuY3Rpb24gaGFuZGxlU3RyZWFtRGF0YShjaHVuaykge1xuICAgICAgICAgIHJlc3BvbnNlQnVmZmVyLnB1c2goY2h1bmspO1xuICAgICAgICAgIHRvdGFsUmVzcG9uc2VCeXRlcyArPSBjaHVuay5sZW5ndGg7XG5cbiAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGNvbnRlbnQgbGVuZ3RoIGlzIG5vdCBvdmVyIHRoZSBtYXhDb250ZW50TGVuZ3RoIGlmIHNwZWNpZmllZFxuICAgICAgICAgIGlmIChjb25maWcubWF4Q29udGVudExlbmd0aCA+IC0xICYmIHRvdGFsUmVzcG9uc2VCeXRlcyA+IGNvbmZpZy5tYXhDb250ZW50TGVuZ3RoKSB7XG4gICAgICAgICAgICBzdHJlYW0uZGVzdHJveSgpO1xuICAgICAgICAgICAgcmVqZWN0KGNyZWF0ZUVycm9yKCdtYXhDb250ZW50TGVuZ3RoIHNpemUgb2YgJyArIGNvbmZpZy5tYXhDb250ZW50TGVuZ3RoICsgJyBleGNlZWRlZCcsXG4gICAgICAgICAgICAgIGNvbmZpZywgbnVsbCwgbGFzdFJlcXVlc3QpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHN0cmVhbS5vbignZXJyb3InLCBmdW5jdGlvbiBoYW5kbGVTdHJlYW1FcnJvcihlcnIpIHtcbiAgICAgICAgICBpZiAocmVxLmFib3J0ZWQpIHJldHVybjtcbiAgICAgICAgICByZWplY3QoZW5oYW5jZUVycm9yKGVyciwgY29uZmlnLCBudWxsLCBsYXN0UmVxdWVzdCkpO1xuICAgICAgICB9KTtcblxuICAgICAgICBzdHJlYW0ub24oJ2VuZCcsIGZ1bmN0aW9uIGhhbmRsZVN0cmVhbUVuZCgpIHtcbiAgICAgICAgICB2YXIgcmVzcG9uc2VEYXRhID0gQnVmZmVyLmNvbmNhdChyZXNwb25zZUJ1ZmZlcik7XG4gICAgICAgICAgaWYgKGNvbmZpZy5yZXNwb25zZVR5cGUgIT09ICdhcnJheWJ1ZmZlcicpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlRGF0YSA9IHJlc3BvbnNlRGF0YS50b1N0cmluZyhjb25maWcucmVzcG9uc2VFbmNvZGluZyk7XG4gICAgICAgICAgICBpZiAoIWNvbmZpZy5yZXNwb25zZUVuY29kaW5nIHx8IGNvbmZpZy5yZXNwb25zZUVuY29kaW5nID09PSAndXRmOCcpIHtcbiAgICAgICAgICAgICAgcmVzcG9uc2VEYXRhID0gdXRpbHMuc3RyaXBCT00ocmVzcG9uc2VEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXNwb25zZS5kYXRhID0gcmVzcG9uc2VEYXRhO1xuICAgICAgICAgIHNldHRsZShyZXNvbHZlLCByZWplY3QsIHJlc3BvbnNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBIYW5kbGUgZXJyb3JzXG4gICAgcmVxLm9uKCdlcnJvcicsIGZ1bmN0aW9uIGhhbmRsZVJlcXVlc3RFcnJvcihlcnIpIHtcbiAgICAgIGlmIChyZXEuYWJvcnRlZCAmJiBlcnIuY29kZSAhPT0gJ0VSUl9GUl9UT09fTUFOWV9SRURJUkVDVFMnKSByZXR1cm47XG4gICAgICByZWplY3QoZW5oYW5jZUVycm9yKGVyciwgY29uZmlnLCBudWxsLCByZXEpKTtcbiAgICB9KTtcblxuICAgIC8vIEhhbmRsZSByZXF1ZXN0IHRpbWVvdXRcbiAgICBpZiAoY29uZmlnLnRpbWVvdXQpIHtcbiAgICAgIC8vIFRoaXMgaXMgZm9yY2luZyBhIGludCB0aW1lb3V0IHRvIGF2b2lkIHByb2JsZW1zIGlmIHRoZSBgcmVxYCBpbnRlcmZhY2UgZG9lc24ndCBoYW5kbGUgb3RoZXIgdHlwZXMuXG4gICAgICB2YXIgdGltZW91dCA9IHBhcnNlSW50KGNvbmZpZy50aW1lb3V0LCAxMCk7XG5cbiAgICAgIGlmIChpc05hTih0aW1lb3V0KSkge1xuICAgICAgICByZWplY3QoY3JlYXRlRXJyb3IoXG4gICAgICAgICAgJ2Vycm9yIHRyeWluZyB0byBwYXJzZSBgY29uZmlnLnRpbWVvdXRgIHRvIGludCcsXG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICdFUlJfUEFSU0VfVElNRU9VVCcsXG4gICAgICAgICAgcmVxXG4gICAgICAgICkpO1xuXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gU29tZXRpbWUsIHRoZSByZXNwb25zZSB3aWxsIGJlIHZlcnkgc2xvdywgYW5kIGRvZXMgbm90IHJlc3BvbmQsIHRoZSBjb25uZWN0IGV2ZW50IHdpbGwgYmUgYmxvY2sgYnkgZXZlbnQgbG9vcCBzeXN0ZW0uXG4gICAgICAvLyBBbmQgdGltZXIgY2FsbGJhY2sgd2lsbCBiZSBmaXJlZCwgYW5kIGFib3J0KCkgd2lsbCBiZSBpbnZva2VkIGJlZm9yZSBjb25uZWN0aW9uLCB0aGVuIGdldCBcInNvY2tldCBoYW5nIHVwXCIgYW5kIGNvZGUgRUNPTk5SRVNFVC5cbiAgICAgIC8vIEF0IHRoaXMgdGltZSwgaWYgd2UgaGF2ZSBhIGxhcmdlIG51bWJlciBvZiByZXF1ZXN0LCBub2RlanMgd2lsbCBoYW5nIHVwIHNvbWUgc29ja2V0IG9uIGJhY2tncm91bmQuIGFuZCB0aGUgbnVtYmVyIHdpbGwgdXAgYW5kIHVwLlxuICAgICAgLy8gQW5kIHRoZW4gdGhlc2Ugc29ja2V0IHdoaWNoIGJlIGhhbmcgdXAgd2lsbCBkZXZvcmluZyBDUFUgbGl0dGxlIGJ5IGxpdHRsZS5cbiAgICAgIC8vIENsaWVudFJlcXVlc3Quc2V0VGltZW91dCB3aWxsIGJlIGZpcmVkIG9uIHRoZSBzcGVjaWZ5IG1pbGxpc2Vjb25kcywgYW5kIGNhbiBtYWtlIHN1cmUgdGhhdCBhYm9ydCgpIHdpbGwgYmUgZmlyZWQgYWZ0ZXIgY29ubmVjdC5cbiAgICAgIHJlcS5zZXRUaW1lb3V0KHRpbWVvdXQsIGZ1bmN0aW9uIGhhbmRsZVJlcXVlc3RUaW1lb3V0KCkge1xuICAgICAgICByZXEuYWJvcnQoKTtcbiAgICAgICAgdmFyIHRyYW5zaXRpb25hbCA9IGNvbmZpZy50cmFuc2l0aW9uYWwgfHwgZGVmYXVsdHMudHJhbnNpdGlvbmFsO1xuICAgICAgICByZWplY3QoY3JlYXRlRXJyb3IoXG4gICAgICAgICAgJ3RpbWVvdXQgb2YgJyArIHRpbWVvdXQgKyAnbXMgZXhjZWVkZWQnLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICB0cmFuc2l0aW9uYWwuY2xhcmlmeVRpbWVvdXRFcnJvciA/ICdFVElNRURPVVQnIDogJ0VDT05OQUJPUlRFRCcsXG4gICAgICAgICAgcmVxXG4gICAgICAgICkpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGNvbmZpZy5jYW5jZWxUb2tlbiB8fCBjb25maWcuc2lnbmFsKSB7XG4gICAgICAvLyBIYW5kbGUgY2FuY2VsbGF0aW9uXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZnVuYy1uYW1lc1xuICAgICAgb25DYW5jZWxlZCA9IGZ1bmN0aW9uKGNhbmNlbCkge1xuICAgICAgICBpZiAocmVxLmFib3J0ZWQpIHJldHVybjtcblxuICAgICAgICByZXEuYWJvcnQoKTtcbiAgICAgICAgcmVqZWN0KCFjYW5jZWwgfHwgKGNhbmNlbCAmJiBjYW5jZWwudHlwZSkgPyBuZXcgQ2FuY2VsKCdjYW5jZWxlZCcpIDogY2FuY2VsKTtcbiAgICAgIH07XG5cbiAgICAgIGNvbmZpZy5jYW5jZWxUb2tlbiAmJiBjb25maWcuY2FuY2VsVG9rZW4uc3Vic2NyaWJlKG9uQ2FuY2VsZWQpO1xuICAgICAgaWYgKGNvbmZpZy5zaWduYWwpIHtcbiAgICAgICAgY29uZmlnLnNpZ25hbC5hYm9ydGVkID8gb25DYW5jZWxlZCgpIDogY29uZmlnLnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uQ2FuY2VsZWQpO1xuICAgICAgfVxuICAgIH1cblxuXG4gICAgLy8gU2VuZCB0aGUgcmVxdWVzdFxuICAgIGlmICh1dGlscy5pc1N0cmVhbShkYXRhKSkge1xuICAgICAgZGF0YS5vbignZXJyb3InLCBmdW5jdGlvbiBoYW5kbGVTdHJlYW1FcnJvcihlcnIpIHtcbiAgICAgICAgcmVqZWN0KGVuaGFuY2VFcnJvcihlcnIsIGNvbmZpZywgbnVsbCwgcmVxKSk7XG4gICAgICB9KS5waXBlKHJlcSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcS5lbmQoZGF0YSk7XG4gICAgfVxuICB9KTtcbn07XG4iXX0=