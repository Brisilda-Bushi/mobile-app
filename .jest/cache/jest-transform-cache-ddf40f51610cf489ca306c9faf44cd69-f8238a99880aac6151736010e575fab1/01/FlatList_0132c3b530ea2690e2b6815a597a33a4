ee3089ce8494d70402326b0d9ad06e54
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _excluded = ["numColumns", "columnWrapperStyle"];

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

var Platform = require("../Utilities/Platform");

var deepDiffer = require("../Utilities/differ/deepDiffer");

var React = require('react');

var View = require("../Components/View/View");

var VirtualizedList = require("./VirtualizedList");

var StyleSheet = require("../StyleSheet/StyleSheet");

var invariant = require('invariant');

var defaultProps = _objectSpread(_objectSpread({}, VirtualizedList.defaultProps), {}, {
  numColumns: 1,
  removeClippedSubviews: Platform.OS === 'android'
});

var FlatList = function (_React$PureComponent) {
  (0, _inherits2.default)(FlatList, _React$PureComponent);

  var _super = _createSuper(FlatList);

  function FlatList(_props) {
    var _this;

    (0, _classCallCheck2.default)(this, FlatList);
    _this = _super.call(this, _props);
    _this._virtualizedListPairs = [];

    _this._captureRef = function (ref) {
      _this._listRef = ref;
    };

    _this._getItem = function (data, index) {
      var numColumns = _this.props.numColumns;

      if (numColumns > 1) {
        var ret = [];

        for (var kk = 0; kk < numColumns; kk++) {
          var _item = data[index * numColumns + kk];

          if (_item != null) {
            ret.push(_item);
          }
        }

        return ret;
      } else {
        return data[index];
      }
    };

    _this._getItemCount = function (data) {
      if (data) {
        var numColumns = _this.props.numColumns;
        return numColumns > 1 ? Math.ceil(data.length / numColumns) : data.length;
      } else {
        return 0;
      }
    };

    _this._keyExtractor = function (items, index) {
      var _this$props = _this.props,
          keyExtractor = _this$props.keyExtractor,
          numColumns = _this$props.numColumns;

      if (numColumns > 1) {
        invariant(Array.isArray(items), 'FlatList: Encountered internal consistency error, expected each item to consist of an ' + 'array with 1-%s columns; instead, received a single item.', numColumns);
        return items.map(function (it, kk) {
          return keyExtractor(it, index * numColumns + kk);
        }).join(':');
      } else {
        return keyExtractor(items, index);
      }
    };

    _this._renderer = function () {
      var _this$props2 = _this.props,
          ListItemComponent = _this$props2.ListItemComponent,
          renderItem = _this$props2.renderItem,
          numColumns = _this$props2.numColumns,
          columnWrapperStyle = _this$props2.columnWrapperStyle;
      var virtualizedListRenderKey = ListItemComponent ? 'ListItemComponent' : 'renderItem';

      var renderer = function renderer(props) {
        if (ListItemComponent) {
          return React.createElement(ListItemComponent, props);
        } else if (renderItem) {
          return renderItem(props);
        } else {
          return null;
        }
      };

      return (0, _defineProperty2.default)({}, virtualizedListRenderKey, function (info) {
        if (numColumns > 1) {
          var _item2 = info.item,
              _index = info.index;
          invariant(Array.isArray(_item2), 'Expected array of items with numColumns > 1');
          return React.createElement(View, {
            style: StyleSheet.compose(styles.row, columnWrapperStyle)
          }, _item2.map(function (it, kk) {
            var element = renderer({
              item: it,
              index: _index * numColumns + kk,
              separators: info.separators
            });
            return element != null ? React.createElement(React.Fragment, {
              key: kk
            }, element) : null;
          }));
        } else {
          return renderer(info);
        }
      });
    };

    _this._checkProps(_this.props);

    if (_this.props.viewabilityConfigCallbackPairs) {
      _this._virtualizedListPairs = _this.props.viewabilityConfigCallbackPairs.map(function (pair) {
        return {
          viewabilityConfig: pair.viewabilityConfig,
          onViewableItemsChanged: _this._createOnViewableItemsChanged(pair.onViewableItemsChanged)
        };
      });
    } else if (_this.props.onViewableItemsChanged) {
      _this._virtualizedListPairs.push({
        viewabilityConfig: _this.props.viewabilityConfig,
        onViewableItemsChanged: _this._createOnViewableItemsChanged(_this.props.onViewableItemsChanged)
      });
    }

    return _this;
  }

  (0, _createClass2.default)(FlatList, [{
    key: "scrollToEnd",
    value: function scrollToEnd(params) {
      if (this._listRef) {
        this._listRef.scrollToEnd(params);
      }
    }
  }, {
    key: "scrollToIndex",
    value: function scrollToIndex(params) {
      if (this._listRef) {
        this._listRef.scrollToIndex(params);
      }
    }
  }, {
    key: "scrollToItem",
    value: function scrollToItem(params) {
      if (this._listRef) {
        this._listRef.scrollToItem(params);
      }
    }
  }, {
    key: "scrollToOffset",
    value: function scrollToOffset(params) {
      if (this._listRef) {
        this._listRef.scrollToOffset(params);
      }
    }
  }, {
    key: "recordInteraction",
    value: function recordInteraction() {
      if (this._listRef) {
        this._listRef.recordInteraction();
      }
    }
  }, {
    key: "flashScrollIndicators",
    value: function flashScrollIndicators() {
      if (this._listRef) {
        this._listRef.flashScrollIndicators();
      }
    }
  }, {
    key: "getScrollResponder",
    value: function getScrollResponder() {
      if (this._listRef) {
        return this._listRef.getScrollResponder();
      }
    }
  }, {
    key: "getNativeScrollRef",
    value: function getNativeScrollRef() {
      if (this._listRef) {
        return this._listRef.getScrollRef();
      }
    }
  }, {
    key: "getScrollableNode",
    value: function getScrollableNode() {
      if (this._listRef) {
        return this._listRef.getScrollableNode();
      }
    }
  }, {
    key: "setNativeProps",
    value: function setNativeProps(props) {
      if (this._listRef) {
        this._listRef.setNativeProps(props);
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      invariant(prevProps.numColumns === this.props.numColumns, 'Changing numColumns on the fly is not supported. Change the key prop on FlatList when ' + 'changing the number of columns to force a fresh render of the component.');
      invariant(prevProps.onViewableItemsChanged === this.props.onViewableItemsChanged, 'Changing onViewableItemsChanged on the fly is not supported');
      invariant(!deepDiffer(prevProps.viewabilityConfig, this.props.viewabilityConfig), 'Changing viewabilityConfig on the fly is not supported');
      invariant(prevProps.viewabilityConfigCallbackPairs === this.props.viewabilityConfigCallbackPairs, 'Changing viewabilityConfigCallbackPairs on the fly is not supported');

      this._checkProps(this.props);
    }
  }, {
    key: "_checkProps",
    value: function _checkProps(props) {
      var getItem = props.getItem,
          getItemCount = props.getItemCount,
          horizontal = props.horizontal,
          numColumns = props.numColumns,
          columnWrapperStyle = props.columnWrapperStyle,
          onViewableItemsChanged = props.onViewableItemsChanged,
          viewabilityConfigCallbackPairs = props.viewabilityConfigCallbackPairs;
      invariant(!getItem && !getItemCount, 'FlatList does not support custom data formats.');

      if (numColumns > 1) {
        invariant(!horizontal, 'numColumns does not support horizontal.');
      } else {
        invariant(!columnWrapperStyle, 'columnWrapperStyle not supported for single column lists');
      }

      invariant(!(onViewableItemsChanged && viewabilityConfigCallbackPairs), 'FlatList does not support setting both onViewableItemsChanged and ' + 'viewabilityConfigCallbackPairs.');
    }
  }, {
    key: "_pushMultiColumnViewable",
    value: function _pushMultiColumnViewable(arr, v) {
      var _this$props3 = this.props,
          numColumns = _this$props3.numColumns,
          keyExtractor = _this$props3.keyExtractor;
      v.item.forEach(function (item, ii) {
        invariant(v.index != null, 'Missing index!');
        var index = v.index * numColumns + ii;
        arr.push(_objectSpread(_objectSpread({}, v), {}, {
          item: item,
          key: keyExtractor(item, index),
          index: index
        }));
      });
    }
  }, {
    key: "_createOnViewableItemsChanged",
    value: function _createOnViewableItemsChanged(onViewableItemsChanged) {
      var _this2 = this;

      return function (info) {
        var numColumns = _this2.props.numColumns;

        if (onViewableItemsChanged) {
          if (numColumns > 1) {
            var changed = [];
            var viewableItems = [];
            info.viewableItems.forEach(function (v) {
              return _this2._pushMultiColumnViewable(viewableItems, v);
            });
            info.changed.forEach(function (v) {
              return _this2._pushMultiColumnViewable(changed, v);
            });
            onViewableItemsChanged({
              viewableItems: viewableItems,
              changed: changed
            });
          } else {
            onViewableItemsChanged(info);
          }
        }
      };
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props4 = this.props,
          numColumns = _this$props4.numColumns,
          columnWrapperStyle = _this$props4.columnWrapperStyle,
          restProps = (0, _objectWithoutProperties2.default)(_this$props4, _excluded);
      return React.createElement(VirtualizedList, (0, _extends2.default)({}, restProps, {
        getItem: this._getItem,
        getItemCount: this._getItemCount,
        keyExtractor: this._keyExtractor,
        ref: this._captureRef,
        viewabilityConfigCallbackPairs: this._virtualizedListPairs
      }, this._renderer()));
    }
  }]);
  return FlatList;
}(React.PureComponent);

FlatList.defaultProps = defaultProps;
var styles = StyleSheet.create({
  row: {
    flexDirection: 'row'
  }
});
module.exports = FlatList;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZsYXRMaXN0LmpzIl0sIm5hbWVzIjpbIlBsYXRmb3JtIiwicmVxdWlyZSIsImRlZXBEaWZmZXIiLCJSZWFjdCIsIlZpZXciLCJWaXJ0dWFsaXplZExpc3QiLCJTdHlsZVNoZWV0IiwiaW52YXJpYW50IiwiZGVmYXVsdFByb3BzIiwibnVtQ29sdW1ucyIsInJlbW92ZUNsaXBwZWRTdWJ2aWV3cyIsIk9TIiwiRmxhdExpc3QiLCJwcm9wcyIsIl92aXJ0dWFsaXplZExpc3RQYWlycyIsIl9jYXB0dXJlUmVmIiwicmVmIiwiX2xpc3RSZWYiLCJfZ2V0SXRlbSIsImRhdGEiLCJpbmRleCIsInJldCIsImtrIiwiaXRlbSIsInB1c2giLCJfZ2V0SXRlbUNvdW50IiwiTWF0aCIsImNlaWwiLCJsZW5ndGgiLCJfa2V5RXh0cmFjdG9yIiwiaXRlbXMiLCJrZXlFeHRyYWN0b3IiLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJpdCIsImpvaW4iLCJfcmVuZGVyZXIiLCJMaXN0SXRlbUNvbXBvbmVudCIsInJlbmRlckl0ZW0iLCJjb2x1bW5XcmFwcGVyU3R5bGUiLCJ2aXJ0dWFsaXplZExpc3RSZW5kZXJLZXkiLCJyZW5kZXJlciIsImluZm8iLCJjb21wb3NlIiwic3R5bGVzIiwicm93IiwiZWxlbWVudCIsInNlcGFyYXRvcnMiLCJfY2hlY2tQcm9wcyIsInZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycyIsInBhaXIiLCJ2aWV3YWJpbGl0eUNvbmZpZyIsIm9uVmlld2FibGVJdGVtc0NoYW5nZWQiLCJfY3JlYXRlT25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCIsInBhcmFtcyIsInNjcm9sbFRvRW5kIiwic2Nyb2xsVG9JbmRleCIsInNjcm9sbFRvSXRlbSIsInNjcm9sbFRvT2Zmc2V0IiwicmVjb3JkSW50ZXJhY3Rpb24iLCJmbGFzaFNjcm9sbEluZGljYXRvcnMiLCJnZXRTY3JvbGxSZXNwb25kZXIiLCJnZXRTY3JvbGxSZWYiLCJnZXRTY3JvbGxhYmxlTm9kZSIsInNldE5hdGl2ZVByb3BzIiwicHJldlByb3BzIiwiZ2V0SXRlbSIsImdldEl0ZW1Db3VudCIsImhvcml6b250YWwiLCJhcnIiLCJ2IiwiZm9yRWFjaCIsImlpIiwia2V5IiwiY2hhbmdlZCIsInZpZXdhYmxlSXRlbXMiLCJfcHVzaE11bHRpQ29sdW1uVmlld2FibGUiLCJyZXN0UHJvcHMiLCJQdXJlQ29tcG9uZW50IiwiY3JlYXRlIiwiZmxleERpcmVjdGlvbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxRQUFRLEdBQUdDLE9BQU8seUJBQXhCOztBQUNBLElBQU1DLFVBQVUsR0FBR0QsT0FBTyxrQ0FBMUI7O0FBQ0EsSUFBTUUsS0FBSyxHQUFHRixPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxJQUFNRyxJQUFJLEdBQUdILE9BQU8sMkJBQXBCOztBQUNBLElBQU1JLGVBQWUsR0FBR0osT0FBTyxxQkFBL0I7O0FBQ0EsSUFBTUssVUFBVSxHQUFHTCxPQUFPLDRCQUExQjs7QUFFQSxJQUFNTSxTQUFTLEdBQUdOLE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQTRJQSxJQUFNTyxZQUFZLG1DQUNiSCxlQUFlLENBQUNHLFlBREg7QUFFaEJDLEVBQUFBLFVBQVUsRUFBRSxDQUZJO0FBUWhCQyxFQUFBQSxxQkFBcUIsRUFBRVYsUUFBUSxDQUFDVyxFQUFULEtBQWdCO0FBUnZCLEVBQWxCOztJQXdITUMsUTs7Ozs7QUFrSEosb0JBQVlDLE1BQVosRUFBaUM7QUFBQTs7QUFBQTtBQUMvQiw4QkFBTUEsTUFBTjtBQUQrQixVQWlEakNDLHFCQWpEaUMsR0FpRDZCLEVBakQ3Qjs7QUFBQSxVQW1EakNDLFdBbkRpQyxHQW1EbkIsVUFBQUMsR0FBRyxFQUFJO0FBQ25CLFlBQUtDLFFBQUwsR0FBZ0JELEdBQWhCO0FBQ0QsS0FyRGdDOztBQUFBLFVBc0ZqQ0UsUUF0RmlDLEdBc0Z0QixVQUFDQyxJQUFELEVBQXFCQyxLQUFyQixF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QUFtQkEsa0JBQW5CO0FBQUEsVUFBMENzQyxTQUExQztBQUVBLGFBQ0Usb0JBQUMsZUFBRCw2QkFDTUEsU0FETjtBQUVFLFFBQUEsT0FBTyxFQUFFLEtBQUs1RCxRQUZoQjtBQUdFLFFBQUEsWUFBWSxFQUFFLEtBQUtPLGFBSHJCO0FBSUUsUUFBQSxZQUFZLEVBQUUsS0FBS0ksYUFKckI7QUFLRSxRQUFBLEdBQUcsRUFBRSxLQUFLZCxXQUxaO0FBTUUsUUFBQSw4QkFBOEIsRUFBRSxLQUFLRDtBQU52QyxTQU9NLEtBQUt1QixTQUFMLEVBUE4sRUFERjtBQVdEOzs7RUE5VjJCbEMsS0FBSyxDQUFDNEUsYTs7QUFBOUJuRSxRLENBQ0dKLFksR0FBNkJBLFk7QUFnV3RDLElBQU1xQyxNQUFNLEdBQUd2QyxVQUFVLENBQUMwRSxNQUFYLENBQWtCO0FBQy9CbEMsRUFBQUEsR0FBRyxFQUFFO0FBQUNtQyxJQUFBQSxhQUFhLEVBQUU7QUFBaEI7QUFEMEIsQ0FBbEIsQ0FBZjtBQUlBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJ2RSxRQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL1BsYXRmb3JtJyk7XG5jb25zdCBkZWVwRGlmZmVyID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL2RpZmZlci9kZWVwRGlmZmVyJyk7XG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBWaWV3ID0gcmVxdWlyZSgnLi4vQ29tcG9uZW50cy9WaWV3L1ZpZXcnKTtcbmNvbnN0IFZpcnR1YWxpemVkTGlzdCA9IHJlcXVpcmUoJy4vVmlydHVhbGl6ZWRMaXN0Jyk7XG5jb25zdCBTdHlsZVNoZWV0ID0gcmVxdWlyZSgnLi4vU3R5bGVTaGVldC9TdHlsZVNoZWV0Jyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG5pbXBvcnQge3R5cGUgU2Nyb2xsUmVzcG9uZGVyVHlwZX0gZnJvbSAnLi4vQ29tcG9uZW50cy9TY3JvbGxWaWV3L1Njcm9sbFZpZXcnO1xuaW1wb3J0IHR5cGUge1Njcm9sbFZpZXdOYXRpdmVDb21wb25lbnRUeXBlfSBmcm9tICcuLi9Db21wb25lbnRzL1Njcm9sbFZpZXcvU2Nyb2xsVmlld05hdGl2ZUNvbXBvbmVudFR5cGUuanMnO1xuaW1wb3J0IHR5cGUge1ZpZXdTdHlsZVByb3B9IGZyb20gJy4uL1N0eWxlU2hlZXQvU3R5bGVTaGVldCc7XG5pbXBvcnQgdHlwZSB7XG4gIFZpZXdUb2tlbixcbiAgVmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXIsXG59IGZyb20gJy4vVmlld2FiaWxpdHlIZWxwZXInO1xuaW1wb3J0IHR5cGUge1JlbmRlckl0ZW1UeXBlLCBSZW5kZXJJdGVtUHJvcHN9IGZyb20gJy4vVmlydHVhbGl6ZWRMaXN0JztcblxudHlwZSBSZXF1aXJlZFByb3BzPEl0ZW1UPiA9IHt8XG4gIC8qKlxuICAgKiBGb3Igc2ltcGxpY2l0eSwgZGF0YSBpcyBqdXN0IGEgcGxhaW4gYXJyYXkuIElmIHlvdSB3YW50IHRvIHVzZSBzb21ldGhpbmcgZWxzZSwgbGlrZSBhblxuICAgKiBpbW11dGFibGUgbGlzdCwgdXNlIHRoZSB1bmRlcmx5aW5nIGBWaXJ0dWFsaXplZExpc3RgIGRpcmVjdGx5LlxuICAgKi9cbiAgZGF0YTogPyRSZWFkT25seUFycmF5PEl0ZW1UPixcbnx9O1xudHlwZSBPcHRpb25hbFByb3BzPEl0ZW1UPiA9IHt8XG4gIC8qKlxuICAgKiBUYWtlcyBhbiBpdGVtIGZyb20gYGRhdGFgIGFuZCByZW5kZXJzIGl0IGludG8gdGhlIGxpc3QuIEV4YW1wbGUgdXNhZ2U6XG4gICAqXG4gICAqICAgICA8RmxhdExpc3RcbiAgICogICAgICAgSXRlbVNlcGFyYXRvckNvbXBvbmVudD17UGxhdGZvcm0uT1MgIT09ICdhbmRyb2lkJyAmJiAoe2hpZ2hsaWdodGVkfSkgPT4gKFxuICAgKiAgICAgICAgIDxWaWV3IHN0eWxlPXtbc3R5bGUuc2VwYXJhdG9yLCBoaWdobGlnaHRlZCAmJiB7bWFyZ2luTGVmdDogMH1dfSAvPlxuICAgKiAgICAgICApfVxuICAgKiAgICAgICBkYXRhPXtbe3RpdGxlOiAnVGl0bGUgVGV4dCcsIGtleTogJ2l0ZW0xJ31dfVxuICAgKiAgICAgICByZW5kZXJJdGVtPXsoe2l0ZW0sIHNlcGFyYXRvcnN9KSA9PiAoXG4gICAqICAgICAgICAgPFRvdWNoYWJsZUhpZ2hsaWdodFxuICAgKiAgICAgICAgICAgb25QcmVzcz17KCkgPT4gdGhpcy5fb25QcmVzcyhpdGVtKX1cbiAgICogICAgICAgICAgIG9uU2hvd1VuZGVybGF5PXtzZXBhcmF0b3JzLmhpZ2hsaWdodH1cbiAgICogICAgICAgICAgIG9uSGlkZVVuZGVybGF5PXtzZXBhcmF0b3JzLnVuaGlnaGxpZ2h0fT5cbiAgICogICAgICAgICAgIDxWaWV3IHN0eWxlPXt7YmFja2dyb3VuZENvbG9yOiAnd2hpdGUnfX0+XG4gICAqICAgICAgICAgICAgIDxUZXh0PntpdGVtLnRpdGxlfTwvVGV4dD5cbiAgICogICAgICAgICAgIDwvVmlldz5cbiAgICogICAgICAgICA8L1RvdWNoYWJsZUhpZ2hsaWdodD5cbiAgICogICAgICAgKX1cbiAgICogICAgIC8+XG4gICAqXG4gICAqIFByb3ZpZGVzIGFkZGl0aW9uYWwgbWV0YWRhdGEgbGlrZSBgaW5kZXhgIGlmIHlvdSBuZWVkIGl0LCBhcyB3ZWxsIGFzIGEgbW9yZSBnZW5lcmljXG4gICAqIGBzZXBhcmF0b3JzLnVwZGF0ZVByb3BzYCBmdW5jdGlvbiB3aGljaCBsZXQncyB5b3Ugc2V0IHdoYXRldmVyIHByb3BzIHlvdSB3YW50IHRvIGNoYW5nZSB0aGVcbiAgICogcmVuZGVyaW5nIG9mIGVpdGhlciB0aGUgbGVhZGluZyBzZXBhcmF0b3Igb3IgdHJhaWxpbmcgc2VwYXJhdG9yIGluIGNhc2UgdGhlIG1vcmUgY29tbW9uXG4gICAqIGBoaWdobGlnaHRgIGFuZCBgdW5oaWdobGlnaHRgICh3aGljaCBzZXQgdGhlIGBoaWdobGlnaHRlZDogYm9vbGVhbmAgcHJvcCkgYXJlIGluc3VmZmljaWVudCBmb3JcbiAgICogeW91ciB1c2UtY2FzZS5cbiAgICovXG4gIHJlbmRlckl0ZW0/OiA/UmVuZGVySXRlbVR5cGU8SXRlbVQ+LFxuXG4gIC8qKlxuICAgKiBPcHRpb25hbCBjdXN0b20gc3R5bGUgZm9yIG11bHRpLWl0ZW0gcm93cyBnZW5lcmF0ZWQgd2hlbiBudW1Db2x1bW5zID4gMS5cbiAgICovXG4gIGNvbHVtbldyYXBwZXJTdHlsZT86IFZpZXdTdHlsZVByb3AsXG4gIC8qKlxuICAgKiBBIG1hcmtlciBwcm9wZXJ0eSBmb3IgdGVsbGluZyB0aGUgbGlzdCB0byByZS1yZW5kZXIgKHNpbmNlIGl0IGltcGxlbWVudHMgYFB1cmVDb21wb25lbnRgKS4gSWZcbiAgICogYW55IG9mIHlvdXIgYHJlbmRlckl0ZW1gLCBIZWFkZXIsIEZvb3RlciwgZXRjLiBmdW5jdGlvbnMgZGVwZW5kIG9uIGFueXRoaW5nIG91dHNpZGUgb2YgdGhlXG4gICAqIGBkYXRhYCBwcm9wLCBzdGljayBpdCBoZXJlIGFuZCB0cmVhdCBpdCBpbW11dGFibHkuXG4gICAqL1xuICBleHRyYURhdGE/OiBhbnksXG4gIC8qKlxuICAgKiBgZ2V0SXRlbUxheW91dGAgaXMgYW4gb3B0aW9uYWwgb3B0aW1pemF0aW9ucyB0aGF0IGxldCB1cyBza2lwIG1lYXN1cmVtZW50IG9mIGR5bmFtaWMgY29udGVudCBpZlxuICAgKiB5b3Uga25vdyB0aGUgaGVpZ2h0IG9mIGl0ZW1zIGEgcHJpb3JpLiBgZ2V0SXRlbUxheW91dGAgaXMgdGhlIG1vc3QgZWZmaWNpZW50LCBhbmQgaXMgZWFzeSB0b1xuICAgKiB1c2UgaWYgeW91IGhhdmUgZml4ZWQgaGVpZ2h0IGl0ZW1zLCBmb3IgZXhhbXBsZTpcbiAgICpcbiAgICogICAgIGdldEl0ZW1MYXlvdXQ9eyhkYXRhLCBpbmRleCkgPT4gKFxuICAgKiAgICAgICB7bGVuZ3RoOiBJVEVNX0hFSUdIVCwgb2Zmc2V0OiBJVEVNX0hFSUdIVCAqIGluZGV4LCBpbmRleH1cbiAgICogICAgICl9XG4gICAqXG4gICAqIEFkZGluZyBgZ2V0SXRlbUxheW91dGAgY2FuIGJlIGEgZ3JlYXQgcGVyZm9ybWFuY2UgYm9vc3QgZm9yIGxpc3RzIG9mIHNldmVyYWwgaHVuZHJlZCBpdGVtcy5cbiAgICogUmVtZW1iZXIgdG8gaW5jbHVkZSBzZXBhcmF0b3IgbGVuZ3RoIChoZWlnaHQgb3Igd2lkdGgpIGluIHlvdXIgb2Zmc2V0IGNhbGN1bGF0aW9uIGlmIHlvdVxuICAgKiBzcGVjaWZ5IGBJdGVtU2VwYXJhdG9yQ29tcG9uZW50YC5cbiAgICovXG4gIGdldEl0ZW1MYXlvdXQ/OiAoXG4gICAgZGF0YTogP0FycmF5PEl0ZW1UPixcbiAgICBpbmRleDogbnVtYmVyLFxuICApID0+IHtcbiAgICBsZW5ndGg6IG51bWJlcixcbiAgICBvZmZzZXQ6IG51bWJlcixcbiAgICBpbmRleDogbnVtYmVyLFxuICAgIC4uLlxuICB9LFxuICAvKipcbiAgICogSWYgdHJ1ZSwgcmVuZGVycyBpdGVtcyBuZXh0IHRvIGVhY2ggb3RoZXIgaG9yaXpvbnRhbGx5IGluc3RlYWQgb2Ygc3RhY2tlZCB2ZXJ0aWNhbGx5LlxuICAgKi9cbiAgaG9yaXpvbnRhbD86ID9ib29sZWFuLFxuICAvKipcbiAgICogSG93IG1hbnkgaXRlbXMgdG8gcmVuZGVyIGluIHRoZSBpbml0aWFsIGJhdGNoLiBUaGlzIHNob3VsZCBiZSBlbm91Z2ggdG8gZmlsbCB0aGUgc2NyZWVuIGJ1dCBub3RcbiAgICogbXVjaCBtb3JlLiBOb3RlIHRoZXNlIGl0ZW1zIHdpbGwgbmV2ZXIgYmUgdW5tb3VudGVkIGFzIHBhcnQgb2YgdGhlIHdpbmRvd2VkIHJlbmRlcmluZyBpbiBvcmRlclxuICAgKiB0byBpbXByb3ZlIHBlcmNlaXZlZCBwZXJmb3JtYW5jZSBvZiBzY3JvbGwtdG8tdG9wIGFjdGlvbnMuXG4gICAqL1xuICBpbml0aWFsTnVtVG9SZW5kZXI6IG51bWJlcixcbiAgLyoqXG4gICAqIEluc3RlYWQgb2Ygc3RhcnRpbmcgYXQgdGhlIHRvcCB3aXRoIHRoZSBmaXJzdCBpdGVtLCBzdGFydCBhdCBgaW5pdGlhbFNjcm9sbEluZGV4YC4gVGhpc1xuICAgKiBkaXNhYmxlcyB0aGUgXCJzY3JvbGwgdG8gdG9wXCIgb3B0aW1pemF0aW9uIHRoYXQga2VlcHMgdGhlIGZpcnN0IGBpbml0aWFsTnVtVG9SZW5kZXJgIGl0ZW1zXG4gICAqIGFsd2F5cyByZW5kZXJlZCBhbmQgaW1tZWRpYXRlbHkgcmVuZGVycyB0aGUgaXRlbXMgc3RhcnRpbmcgYXQgdGhpcyBpbml0aWFsIGluZGV4LiBSZXF1aXJlc1xuICAgKiBgZ2V0SXRlbUxheW91dGAgdG8gYmUgaW1wbGVtZW50ZWQuXG4gICAqL1xuICBpbml0aWFsU2Nyb2xsSW5kZXg/OiA/bnVtYmVyLFxuICAvKipcbiAgICogUmV2ZXJzZXMgdGhlIGRpcmVjdGlvbiBvZiBzY3JvbGwuIFVzZXMgc2NhbGUgdHJhbnNmb3JtcyBvZiAtMS5cbiAgICovXG4gIGludmVydGVkPzogP2Jvb2xlYW4sXG4gIC8qKlxuICAgKiBVc2VkIHRvIGV4dHJhY3QgYSB1bmlxdWUga2V5IGZvciBhIGdpdmVuIGl0ZW0gYXQgdGhlIHNwZWNpZmllZCBpbmRleC4gS2V5IGlzIHVzZWQgZm9yIGNhY2hpbmdcbiAgICogYW5kIGFzIHRoZSByZWFjdCBrZXkgdG8gdHJhY2sgaXRlbSByZS1vcmRlcmluZy4gVGhlIGRlZmF1bHQgZXh0cmFjdG9yIGNoZWNrcyBgaXRlbS5rZXlgLCB0aGVuXG4gICAqIGZhbGxzIGJhY2sgdG8gdXNpbmcgdGhlIGluZGV4LCBsaWtlIFJlYWN0IGRvZXMuXG4gICAqL1xuICBrZXlFeHRyYWN0b3I6IChpdGVtOiBJdGVtVCwgaW5kZXg6IG51bWJlcikgPT4gc3RyaW5nLFxuICAvKipcbiAgICogTXVsdGlwbGUgY29sdW1ucyBjYW4gb25seSBiZSByZW5kZXJlZCB3aXRoIGBob3Jpem9udGFsPXtmYWxzZX1gIGFuZCB3aWxsIHppZy16YWcgbGlrZSBhXG4gICAqIGBmbGV4V3JhcGAgbGF5b3V0LiBJdGVtcyBzaG91bGQgYWxsIGJlIHRoZSBzYW1lIGhlaWdodCAtIG1hc29ucnkgbGF5b3V0cyBhcmUgbm90IHN1cHBvcnRlZC5cbiAgICovXG4gIG51bUNvbHVtbnM6IG51bWJlcixcbiAgLyoqXG4gICAqIFNlZSBgU2Nyb2xsVmlld2AgZm9yIGZsb3cgdHlwZSBhbmQgZnVydGhlciBkb2N1bWVudGF0aW9uLlxuICAgKi9cbiAgZmFkaW5nRWRnZUxlbmd0aD86ID9udW1iZXIsXG58fTtcblxudHlwZSBGbGF0TGlzdFByb3BzPEl0ZW1UPiA9IHt8XG4gIC4uLlJlcXVpcmVkUHJvcHM8SXRlbVQ+LFxuICAuLi5PcHRpb25hbFByb3BzPEl0ZW1UPixcbnx9O1xuXG50eXBlIFZpcnR1YWxpemVkTGlzdFByb3BzID0gUmVhY3QuRWxlbWVudENvbmZpZzx0eXBlb2YgVmlydHVhbGl6ZWRMaXN0PjtcblxuZXhwb3J0IHR5cGUgUHJvcHM8SXRlbVQ+ID0ge1xuICAuLi4kRGlmZjxcbiAgICBWaXJ0dWFsaXplZExpc3RQcm9wcyxcbiAgICB7XG4gICAgICBnZXRJdGVtOiAkUHJvcGVydHlUeXBlPFZpcnR1YWxpemVkTGlzdFByb3BzLCAnZ2V0SXRlbSc+LFxuICAgICAgZ2V0SXRlbUNvdW50OiAkUHJvcGVydHlUeXBlPFZpcnR1YWxpemVkTGlzdFByb3BzLCAnZ2V0SXRlbUNvdW50Jz4sXG4gICAgICBnZXRJdGVtTGF5b3V0OiAkUHJvcGVydHlUeXBlPFZpcnR1YWxpemVkTGlzdFByb3BzLCAnZ2V0SXRlbUxheW91dCc+LFxuICAgICAgcmVuZGVySXRlbTogJFByb3BlcnR5VHlwZTxWaXJ0dWFsaXplZExpc3RQcm9wcywgJ3JlbmRlckl0ZW0nPixcbiAgICAgIGtleUV4dHJhY3RvcjogJFByb3BlcnR5VHlwZTxWaXJ0dWFsaXplZExpc3RQcm9wcywgJ2tleUV4dHJhY3Rvcic+LFxuICAgICAgLi4uXG4gICAgfSxcbiAgPixcbiAgLi4uRmxhdExpc3RQcm9wczxJdGVtVD4sXG4gIC4uLlxufTtcblxuY29uc3QgZGVmYXVsdFByb3BzID0ge1xuICAuLi5WaXJ0dWFsaXplZExpc3QuZGVmYXVsdFByb3BzLFxuICBudW1Db2x1bW5zOiAxLFxuICAvKipcbiAgICogRW5hYmxpbmcgdGhpcyBwcm9wIG9uIEFuZHJvaWQgZ3JlYXRseSBpbXByb3ZlcyBzY3JvbGxpbmcgcGVyZm9ybWFuY2Ugd2l0aCBubyBrbm93biBpc3N1ZXMuXG4gICAqIFRoZSBhbHRlcm5hdGl2ZSBpcyB0aGF0IHNjcm9sbGluZyBvbiBBbmRyb2lkIGlzIHVudXNhYmx5IGJhZC4gRW5hYmxpbmcgaXQgb24gaU9TIGhhcyBhIGZld1xuICAgKiBrbm93biBpc3N1ZXMuXG4gICAqL1xuICByZW1vdmVDbGlwcGVkU3Vidmlld3M6IFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcsXG59O1xuZXhwb3J0IHR5cGUgRGVmYXVsdFByb3BzID0gdHlwZW9mIGRlZmF1bHRQcm9wcztcblxuLyoqXG4gKiBBIHBlcmZvcm1hbnQgaW50ZXJmYWNlIGZvciByZW5kZXJpbmcgc2ltcGxlLCBmbGF0IGxpc3RzLCBzdXBwb3J0aW5nIHRoZSBtb3N0IGhhbmR5IGZlYXR1cmVzOlxuICpcbiAqICAtIEZ1bGx5IGNyb3NzLXBsYXRmb3JtLlxuICogIC0gT3B0aW9uYWwgaG9yaXpvbnRhbCBtb2RlLlxuICogIC0gQ29uZmlndXJhYmxlIHZpZXdhYmlsaXR5IGNhbGxiYWNrcy5cbiAqICAtIEhlYWRlciBzdXBwb3J0LlxuICogIC0gRm9vdGVyIHN1cHBvcnQuXG4gKiAgLSBTZXBhcmF0b3Igc3VwcG9ydC5cbiAqICAtIFB1bGwgdG8gUmVmcmVzaC5cbiAqICAtIFNjcm9sbCBsb2FkaW5nLlxuICogIC0gU2Nyb2xsVG9JbmRleCBzdXBwb3J0LlxuICpcbiAqIElmIHlvdSBuZWVkIHNlY3Rpb24gc3VwcG9ydCwgdXNlIFtgPFNlY3Rpb25MaXN0PmBdKGRvY3Mvc2VjdGlvbmxpc3QuaHRtbCkuXG4gKlxuICogTWluaW1hbCBFeGFtcGxlOlxuICpcbiAqICAgICA8RmxhdExpc3RcbiAqICAgICAgIGRhdGE9e1t7a2V5OiAnYSd9LCB7a2V5OiAnYid9XX1cbiAqICAgICAgIHJlbmRlckl0ZW09eyh7aXRlbX0pID0+IDxUZXh0PntpdGVtLmtleX08L1RleHQ+fVxuICogICAgIC8+XG4gKlxuICogTW9yZSBjb21wbGV4LCBtdWx0aS1zZWxlY3QgZXhhbXBsZSBkZW1vbnN0cmF0aW5nIGBQdXJlQ29tcG9uZW50YCB1c2FnZSBmb3IgcGVyZiBvcHRpbWl6YXRpb24gYW5kIGF2b2lkaW5nIGJ1Z3MuXG4gKlxuICogLSBCeSBiaW5kaW5nIHRoZSBgb25QcmVzc0l0ZW1gIGhhbmRsZXIsIHRoZSBwcm9wcyB3aWxsIHJlbWFpbiBgPT09YCBhbmQgYFB1cmVDb21wb25lbnRgIHdpbGxcbiAqICAgcHJldmVudCB3YXN0ZWZ1bCByZS1yZW5kZXJzIHVubGVzcyB0aGUgYWN0dWFsIGBpZGAsIGBzZWxlY3RlZGAsIG9yIGB0aXRsZWAgcHJvcHMgY2hhbmdlLCBldmVuXG4gKiAgIGlmIHRoZSBjb21wb25lbnRzIHJlbmRlcmVkIGluIGBNeUxpc3RJdGVtYCBkaWQgbm90IGhhdmUgc3VjaCBvcHRpbWl6YXRpb25zLlxuICogLSBCeSBwYXNzaW5nIGBleHRyYURhdGE9e3RoaXMuc3RhdGV9YCB0byBgRmxhdExpc3RgIHdlIG1ha2Ugc3VyZSBgRmxhdExpc3RgIGl0c2VsZiB3aWxsIHJlLXJlbmRlclxuICogICB3aGVuIHRoZSBgc3RhdGUuc2VsZWN0ZWRgIGNoYW5nZXMuIFdpdGhvdXQgc2V0dGluZyB0aGlzIHByb3AsIGBGbGF0TGlzdGAgd291bGQgbm90IGtub3cgaXRcbiAqICAgbmVlZHMgdG8gcmUtcmVuZGVyIGFueSBpdGVtcyBiZWNhdXNlIGl0IGlzIGFsc28gYSBgUHVyZUNvbXBvbmVudGAgYW5kIHRoZSBwcm9wIGNvbXBhcmlzb24gd2lsbFxuICogICBub3Qgc2hvdyBhbnkgY2hhbmdlcy5cbiAqIC0gYGtleUV4dHJhY3RvcmAgdGVsbHMgdGhlIGxpc3QgdG8gdXNlIHRoZSBgaWRgcyBmb3IgdGhlIHJlYWN0IGtleXMgaW5zdGVhZCBvZiB0aGUgZGVmYXVsdCBga2V5YCBwcm9wZXJ0eS5cbiAqXG4gKlxuICogICAgIGNsYXNzIE15TGlzdEl0ZW0gZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50IHtcbiAqICAgICAgIF9vblByZXNzID0gKCkgPT4ge1xuICogICAgICAgICB0aGlzLnByb3BzLm9uUHJlc3NJdGVtKHRoaXMucHJvcHMuaWQpO1xuICogICAgICAgfTtcbiAqXG4gKiAgICAgICByZW5kZXIoKSB7XG4gKiAgICAgICAgIGNvbnN0IHRleHRDb2xvciA9IHRoaXMucHJvcHMuc2VsZWN0ZWQgPyBcInJlZFwiIDogXCJibGFja1wiO1xuICogICAgICAgICByZXR1cm4gKFxuICogICAgICAgICAgIDxUb3VjaGFibGVPcGFjaXR5IG9uUHJlc3M9e3RoaXMuX29uUHJlc3N9PlxuICogICAgICAgICAgICAgPFZpZXc+XG4gKiAgICAgICAgICAgICAgIDxUZXh0IHN0eWxlPXt7IGNvbG9yOiB0ZXh0Q29sb3IgfX0+XG4gKiAgICAgICAgICAgICAgICAge3RoaXMucHJvcHMudGl0bGV9XG4gKiAgICAgICAgICAgICAgIDwvVGV4dD5cbiAqICAgICAgICAgICAgIDwvVmlldz5cbiAqICAgICAgICAgICA8L1RvdWNoYWJsZU9wYWNpdHk+XG4gKiAgICAgICAgICk7XG4gKiAgICAgICB9XG4gKiAgICAgfVxuICpcbiAqICAgICBjbGFzcyBNdWx0aVNlbGVjdExpc3QgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50IHtcbiAqICAgICAgIHN0YXRlID0ge3NlbGVjdGVkOiAobmV3IE1hcCgpOiBNYXA8c3RyaW5nLCBib29sZWFuPil9O1xuICpcbiAqICAgICAgIF9rZXlFeHRyYWN0b3IgPSAoaXRlbSwgaW5kZXgpID0+IGl0ZW0uaWQ7XG4gKlxuICogICAgICAgX29uUHJlc3NJdGVtID0gKGlkOiBzdHJpbmcpID0+IHtcbiAqICAgICAgICAgLy8gdXBkYXRlciBmdW5jdGlvbnMgYXJlIHByZWZlcnJlZCBmb3IgdHJhbnNhY3Rpb25hbCB1cGRhdGVzXG4gKiAgICAgICAgIHRoaXMuc2V0U3RhdGUoKHN0YXRlKSA9PiB7XG4gKiAgICAgICAgICAgLy8gY29weSB0aGUgbWFwIHJhdGhlciB0aGFuIG1vZGlmeWluZyBzdGF0ZS5cbiAqICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IG5ldyBNYXAoc3RhdGUuc2VsZWN0ZWQpO1xuICogICAgICAgICAgIHNlbGVjdGVkLnNldChpZCwgIXNlbGVjdGVkLmdldChpZCkpOyAvLyB0b2dnbGVcbiAqICAgICAgICAgICByZXR1cm4ge3NlbGVjdGVkfTtcbiAqICAgICAgICAgfSk7XG4gKiAgICAgICB9O1xuICpcbiAqICAgICAgIF9yZW5kZXJJdGVtID0gKHtpdGVtfSkgPT4gKFxuICogICAgICAgICA8TXlMaXN0SXRlbVxuICogICAgICAgICAgIGlkPXtpdGVtLmlkfVxuICogICAgICAgICAgIG9uUHJlc3NJdGVtPXt0aGlzLl9vblByZXNzSXRlbX1cbiAqICAgICAgICAgICBzZWxlY3RlZD17ISF0aGlzLnN0YXRlLnNlbGVjdGVkLmdldChpdGVtLmlkKX1cbiAqICAgICAgICAgICB0aXRsZT17aXRlbS50aXRsZX1cbiAqICAgICAgICAgLz5cbiAqICAgICAgICk7XG4gKlxuICogICAgICAgcmVuZGVyKCkge1xuICogICAgICAgICByZXR1cm4gKFxuICogICAgICAgICAgIDxGbGF0TGlzdFxuICogICAgICAgICAgICAgZGF0YT17dGhpcy5wcm9wcy5kYXRhfVxuICogICAgICAgICAgICAgZXh0cmFEYXRhPXt0aGlzLnN0YXRlfVxuICogICAgICAgICAgICAga2V5RXh0cmFjdG9yPXt0aGlzLl9rZXlFeHRyYWN0b3J9XG4gKiAgICAgICAgICAgICByZW5kZXJJdGVtPXt0aGlzLl9yZW5kZXJJdGVtfVxuICogICAgICAgICAgIC8+XG4gKiAgICAgICAgICk7XG4gKiAgICAgICB9XG4gKiAgICAgfVxuICpcbiAqIFRoaXMgaXMgYSBjb252ZW5pZW5jZSB3cmFwcGVyIGFyb3VuZCBbYDxWaXJ0dWFsaXplZExpc3Q+YF0oZG9jcy92aXJ0dWFsaXplZGxpc3QuaHRtbCksXG4gKiBhbmQgdGh1cyBpbmhlcml0cyBpdHMgcHJvcHMgKGFzIHdlbGwgYXMgdGhvc2Ugb2YgYFNjcm9sbFZpZXdgKSB0aGF0IGFyZW4ndCBleHBsaWNpdGx5IGxpc3RlZFxuICogaGVyZSwgYWxvbmcgd2l0aCB0aGUgZm9sbG93aW5nIGNhdmVhdHM6XG4gKlxuICogLSBJbnRlcm5hbCBzdGF0ZSBpcyBub3QgcHJlc2VydmVkIHdoZW4gY29udGVudCBzY3JvbGxzIG91dCBvZiB0aGUgcmVuZGVyIHdpbmRvdy4gTWFrZSBzdXJlIGFsbFxuICogICB5b3VyIGRhdGEgaXMgY2FwdHVyZWQgaW4gdGhlIGl0ZW0gZGF0YSBvciBleHRlcm5hbCBzdG9yZXMgbGlrZSBGbHV4LCBSZWR1eCwgb3IgUmVsYXkuXG4gKiAtIFRoaXMgaXMgYSBgUHVyZUNvbXBvbmVudGAgd2hpY2ggbWVhbnMgdGhhdCBpdCB3aWxsIG5vdCByZS1yZW5kZXIgaWYgYHByb3BzYCByZW1haW4gc2hhbGxvdy1cbiAqICAgZXF1YWwuIE1ha2Ugc3VyZSB0aGF0IGV2ZXJ5dGhpbmcgeW91ciBgcmVuZGVySXRlbWAgZnVuY3Rpb24gZGVwZW5kcyBvbiBpcyBwYXNzZWQgYXMgYSBwcm9wXG4gKiAgIChlLmcuIGBleHRyYURhdGFgKSB0aGF0IGlzIG5vdCBgPT09YCBhZnRlciB1cGRhdGVzLCBvdGhlcndpc2UgeW91ciBVSSBtYXkgbm90IHVwZGF0ZSBvblxuICogICBjaGFuZ2VzLiBUaGlzIGluY2x1ZGVzIHRoZSBgZGF0YWAgcHJvcCBhbmQgcGFyZW50IGNvbXBvbmVudCBzdGF0ZS5cbiAqIC0gSW4gb3JkZXIgdG8gY29uc3RyYWluIG1lbW9yeSBhbmQgZW5hYmxlIHNtb290aCBzY3JvbGxpbmcsIGNvbnRlbnQgaXMgcmVuZGVyZWQgYXN5bmNocm9ub3VzbHlcbiAqICAgb2Zmc2NyZWVuLiBUaGlzIG1lYW5zIGl0J3MgcG9zc2libGUgdG8gc2Nyb2xsIGZhc3RlciB0aGFuIHRoZSBmaWxsIHJhdGUgYW5kcyBtb21lbnRhcmlseSBzZWVcbiAqICAgYmxhbmsgY29udGVudC4gVGhpcyBpcyBhIHRyYWRlb2ZmIHRoYXQgY2FuIGJlIGFkanVzdGVkIHRvIHN1aXQgdGhlIG5lZWRzIG9mIGVhY2ggYXBwbGljYXRpb24sXG4gKiAgIGFuZCB3ZSBhcmUgd29ya2luZyBvbiBpbXByb3ZpbmcgaXQgYmVoaW5kIHRoZSBzY2VuZXMuXG4gKiAtIEJ5IGRlZmF1bHQsIHRoZSBsaXN0IGxvb2tzIGZvciBhIGBrZXlgIHByb3Agb24gZWFjaCBpdGVtIGFuZCB1c2VzIHRoYXQgZm9yIHRoZSBSZWFjdCBrZXkuXG4gKiAgIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gcHJvdmlkZSBhIGN1c3RvbSBga2V5RXh0cmFjdG9yYCBwcm9wLlxuICpcbiAqIEFsc28gaW5oZXJpdHMgW1Njcm9sbFZpZXcgUHJvcHNdKGRvY3Mvc2Nyb2xsdmlldy5odG1sI3Byb3BzKSwgdW5sZXNzIGl0IGlzIG5lc3RlZCBpbiBhbm90aGVyIEZsYXRMaXN0IG9mIHNhbWUgb3JpZW50YXRpb24uXG4gKi9cbmNsYXNzIEZsYXRMaXN0PEl0ZW1UPiBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8UHJvcHM8SXRlbVQ+LCB2b2lkPiB7XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHM6IERlZmF1bHRQcm9wcyA9IGRlZmF1bHRQcm9wcztcbiAgcHJvcHM6IFByb3BzPEl0ZW1UPjtcbiAgLyoqXG4gICAqIFNjcm9sbHMgdG8gdGhlIGVuZCBvZiB0aGUgY29udGVudC4gTWF5IGJlIGphbmt5IHdpdGhvdXQgYGdldEl0ZW1MYXlvdXRgIHByb3AuXG4gICAqL1xuICBzY3JvbGxUb0VuZChwYXJhbXM/OiA/e2FuaW1hdGVkPzogP2Jvb2xlYW4sIC4uLn0pIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5zY3JvbGxUb0VuZChwYXJhbXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTY3JvbGxzIHRvIHRoZSBpdGVtIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXggc3VjaCB0aGF0IGl0IGlzIHBvc2l0aW9uZWQgaW4gdGhlIHZpZXdhYmxlIGFyZWFcbiAgICogc3VjaCB0aGF0IGB2aWV3UG9zaXRpb25gIDAgcGxhY2VzIGl0IGF0IHRoZSB0b3AsIDEgYXQgdGhlIGJvdHRvbSwgYW5kIDAuNSBjZW50ZXJlZCBpbiB0aGVcbiAgICogbWlkZGxlLiBgdmlld09mZnNldGAgaXMgYSBmaXhlZCBudW1iZXIgb2YgcGl4ZWxzIHRvIG9mZnNldCB0aGUgZmluYWwgdGFyZ2V0IHBvc2l0aW9uLlxuICAgKlxuICAgKiBOb3RlOiBjYW5ub3Qgc2Nyb2xsIHRvIGxvY2F0aW9ucyBvdXRzaWRlIHRoZSByZW5kZXIgd2luZG93IHdpdGhvdXQgc3BlY2lmeWluZyB0aGVcbiAgICogYGdldEl0ZW1MYXlvdXRgIHByb3AuXG4gICAqL1xuICBzY3JvbGxUb0luZGV4KHBhcmFtczoge1xuICAgIGFuaW1hdGVkPzogP2Jvb2xlYW4sXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICB2aWV3T2Zmc2V0PzogbnVtYmVyLFxuICAgIHZpZXdQb3NpdGlvbj86IG51bWJlcixcbiAgICAuLi5cbiAgfSkge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICB0aGlzLl9saXN0UmVmLnNjcm9sbFRvSW5kZXgocGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVxdWlyZXMgbGluZWFyIHNjYW4gdGhyb3VnaCBkYXRhIC0gdXNlIGBzY3JvbGxUb0luZGV4YCBpbnN0ZWFkIGlmIHBvc3NpYmxlLlxuICAgKlxuICAgKiBOb3RlOiBjYW5ub3Qgc2Nyb2xsIHRvIGxvY2F0aW9ucyBvdXRzaWRlIHRoZSByZW5kZXIgd2luZG93IHdpdGhvdXQgc3BlY2lmeWluZyB0aGVcbiAgICogYGdldEl0ZW1MYXlvdXRgIHByb3AuXG4gICAqL1xuICBzY3JvbGxUb0l0ZW0ocGFyYW1zOiB7XG4gICAgYW5pbWF0ZWQ/OiA/Ym9vbGVhbixcbiAgICBpdGVtOiBJdGVtVCxcbiAgICB2aWV3UG9zaXRpb24/OiBudW1iZXIsXG4gICAgLi4uXG4gIH0pIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5zY3JvbGxUb0l0ZW0ocGFyYW1zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2Nyb2xsIHRvIGEgc3BlY2lmaWMgY29udGVudCBwaXhlbCBvZmZzZXQgaW4gdGhlIGxpc3QuXG4gICAqXG4gICAqIENoZWNrIG91dCBbc2Nyb2xsVG9PZmZzZXRdKGRvY3MvdmlydHVhbGl6ZWRsaXN0Lmh0bWwjc2Nyb2xsdG9vZmZzZXQpIG9mIFZpcnR1YWxpemVkTGlzdFxuICAgKi9cbiAgc2Nyb2xsVG9PZmZzZXQocGFyYW1zOiB7YW5pbWF0ZWQ/OiA/Ym9vbGVhbiwgb2Zmc2V0OiBudW1iZXIsIC4uLn0pIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5zY3JvbGxUb09mZnNldChwYXJhbXMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUZWxscyB0aGUgbGlzdCBhbiBpbnRlcmFjdGlvbiBoYXMgb2NjdXJyZWQsIHdoaWNoIHNob3VsZCB0cmlnZ2VyIHZpZXdhYmlsaXR5IGNhbGN1bGF0aW9ucywgZS5nLlxuICAgKiBpZiBgd2FpdEZvckludGVyYWN0aW9uc2AgaXMgdHJ1ZSBhbmQgdGhlIHVzZXIgaGFzIG5vdCBzY3JvbGxlZC4gVGhpcyBpcyB0eXBpY2FsbHkgY2FsbGVkIGJ5XG4gICAqIHRhcHMgb24gaXRlbXMgb3IgYnkgbmF2aWdhdGlvbiBhY3Rpb25zLlxuICAgKi9cbiAgcmVjb3JkSW50ZXJhY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX2xpc3RSZWYpIHtcbiAgICAgIHRoaXMuX2xpc3RSZWYucmVjb3JkSW50ZXJhY3Rpb24oKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGlzcGxheXMgdGhlIHNjcm9sbCBpbmRpY2F0b3JzIG1vbWVudGFyaWx5LlxuICAgKlxuICAgKiBAcGxhdGZvcm0gaW9zXG4gICAqL1xuICBmbGFzaFNjcm9sbEluZGljYXRvcnMoKSB7XG4gICAgaWYgKHRoaXMuX2xpc3RSZWYpIHtcbiAgICAgIHRoaXMuX2xpc3RSZWYuZmxhc2hTY3JvbGxJbmRpY2F0b3JzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFByb3ZpZGVzIGEgaGFuZGxlIHRvIHRoZSB1bmRlcmx5aW5nIHNjcm9sbCByZXNwb25kZXIuXG4gICAqL1xuICBnZXRTY3JvbGxSZXNwb25kZXIoKTogP1Njcm9sbFJlc3BvbmRlclR5cGUge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbGlzdFJlZi5nZXRTY3JvbGxSZXNwb25kZXIoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJvdmlkZXMgYSByZWZlcmVuY2UgdG8gdGhlIHVuZGVybHlpbmcgaG9zdCBjb21wb25lbnRcbiAgICovXG4gIGdldE5hdGl2ZVNjcm9sbFJlZigpOlxuICAgIHwgP1JlYWN0LkVsZW1lbnRSZWY8dHlwZW9mIFZpZXc+XG4gICAgfCA/UmVhY3QuRWxlbWVudFJlZjxTY3JvbGxWaWV3TmF0aXZlQ29tcG9uZW50VHlwZT4ge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbGlzdFJlZi5nZXRTY3JvbGxSZWYoKTtcbiAgICB9XG4gIH1cblxuICBnZXRTY3JvbGxhYmxlTm9kZSgpOiBhbnkge1xuICAgIGlmICh0aGlzLl9saXN0UmVmKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbGlzdFJlZi5nZXRTY3JvbGxhYmxlTm9kZSgpO1xuICAgIH1cbiAgfVxuXG4gIHNldE5hdGl2ZVByb3BzKHByb3BzOiB7W3N0cmluZ106IG1peGVkLCAuLi59KSB7XG4gICAgaWYgKHRoaXMuX2xpc3RSZWYpIHtcbiAgICAgIHRoaXMuX2xpc3RSZWYuc2V0TmF0aXZlUHJvcHMocHJvcHMpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBQcm9wczxJdGVtVD4pIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5fY2hlY2tQcm9wcyh0aGlzLnByb3BzKTtcbiAgICBpZiAodGhpcy5wcm9wcy52aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMpIHtcbiAgICAgIHRoaXMuX3ZpcnR1YWxpemVkTGlzdFBhaXJzID0gdGhpcy5wcm9wcy52aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMubWFwKFxuICAgICAgICBwYWlyID0+ICh7XG4gICAgICAgICAgdmlld2FiaWxpdHlDb25maWc6IHBhaXIudmlld2FiaWxpdHlDb25maWcsXG4gICAgICAgICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZDogdGhpcy5fY3JlYXRlT25WaWV3YWJsZUl0ZW1zQ2hhbmdlZChcbiAgICAgICAgICAgIHBhaXIub25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCxcbiAgICAgICAgICApLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLm9uVmlld2FibGVJdGVtc0NoYW5nZWQpIHtcbiAgICAgIHRoaXMuX3ZpcnR1YWxpemVkTGlzdFBhaXJzLnB1c2goe1xuICAgICAgICAvKiAkRmxvd0ZpeE1lKD49MC42My4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICAgICAgICAgKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuNjMgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yIGRlbGV0ZVxuICAgICAgICAgKiB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgICAgICB2aWV3YWJpbGl0eUNvbmZpZzogdGhpcy5wcm9wcy52aWV3YWJpbGl0eUNvbmZpZyxcbiAgICAgICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZDogdGhpcy5fY3JlYXRlT25WaWV3YWJsZUl0ZW1zQ2hhbmdlZChcbiAgICAgICAgICB0aGlzLnByb3BzLm9uVmlld2FibGVJdGVtc0NoYW5nZWQsXG4gICAgICAgICksXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzOiBQcm9wczxJdGVtVD4pIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBwcmV2UHJvcHMubnVtQ29sdW1ucyA9PT0gdGhpcy5wcm9wcy5udW1Db2x1bW5zLFxuICAgICAgJ0NoYW5naW5nIG51bUNvbHVtbnMgb24gdGhlIGZseSBpcyBub3Qgc3VwcG9ydGVkLiBDaGFuZ2UgdGhlIGtleSBwcm9wIG9uIEZsYXRMaXN0IHdoZW4gJyArXG4gICAgICAgICdjaGFuZ2luZyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgdG8gZm9yY2UgYSBmcmVzaCByZW5kZXIgb2YgdGhlIGNvbXBvbmVudC4nLFxuICAgICk7XG4gICAgaW52YXJpYW50KFxuICAgICAgcHJldlByb3BzLm9uVmlld2FibGVJdGVtc0NoYW5nZWQgPT09IHRoaXMucHJvcHMub25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCxcbiAgICAgICdDaGFuZ2luZyBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkIG9uIHRoZSBmbHkgaXMgbm90IHN1cHBvcnRlZCcsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhZGVlcERpZmZlcihwcmV2UHJvcHMudmlld2FiaWxpdHlDb25maWcsIHRoaXMucHJvcHMudmlld2FiaWxpdHlDb25maWcpLFxuICAgICAgJ0NoYW5naW5nIHZpZXdhYmlsaXR5Q29uZmlnIG9uIHRoZSBmbHkgaXMgbm90IHN1cHBvcnRlZCcsXG4gICAgKTtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBwcmV2UHJvcHMudmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzID09PVxuICAgICAgICB0aGlzLnByb3BzLnZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycyxcbiAgICAgICdDaGFuZ2luZyB2aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMgb24gdGhlIGZseSBpcyBub3Qgc3VwcG9ydGVkJyxcbiAgICApO1xuXG4gICAgdGhpcy5fY2hlY2tQcm9wcyh0aGlzLnByb3BzKTtcbiAgfVxuXG4gIF9saXN0UmVmOiA/UmVhY3QuRWxlbWVudFJlZjx0eXBlb2YgVmlydHVhbGl6ZWRMaXN0PjtcbiAgX3ZpcnR1YWxpemVkTGlzdFBhaXJzOiBBcnJheTxWaWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcj4gPSBbXTtcblxuICBfY2FwdHVyZVJlZiA9IHJlZiA9PiB7XG4gICAgdGhpcy5fbGlzdFJlZiA9IHJlZjtcbiAgfTtcblxuICBfY2hlY2tQcm9wcyhwcm9wczogUHJvcHM8SXRlbVQ+KSB7XG4gICAgY29uc3Qge1xuICAgICAgLy8gJEZsb3dGaXhNZSB0aGlzIHByb3AgZG9lc24ndCBleGlzdCwgaXMgb25seSB1c2VkIGZvciBhbiBpbnZhcmlhbnRcbiAgICAgIGdldEl0ZW0sXG4gICAgICAvLyAkRmxvd0ZpeE1lIHRoaXMgcHJvcCBkb2Vzbid0IGV4aXN0LCBpcyBvbmx5IHVzZWQgZm9yIGFuIGludmFyaWFudFxuICAgICAgZ2V0SXRlbUNvdW50LFxuICAgICAgaG9yaXpvbnRhbCxcbiAgICAgIG51bUNvbHVtbnMsXG4gICAgICBjb2x1bW5XcmFwcGVyU3R5bGUsXG4gICAgICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkLFxuICAgICAgdmlld2FiaWxpdHlDb25maWdDYWxsYmFja1BhaXJzLFxuICAgIH0gPSBwcm9wcztcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhZ2V0SXRlbSAmJiAhZ2V0SXRlbUNvdW50LFxuICAgICAgJ0ZsYXRMaXN0IGRvZXMgbm90IHN1cHBvcnQgY3VzdG9tIGRhdGEgZm9ybWF0cy4nLFxuICAgICk7XG4gICAgaWYgKG51bUNvbHVtbnMgPiAxKSB7XG4gICAgICBpbnZhcmlhbnQoIWhvcml6b250YWwsICdudW1Db2x1bW5zIGRvZXMgbm90IHN1cHBvcnQgaG9yaXpvbnRhbC4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICAhY29sdW1uV3JhcHBlclN0eWxlLFxuICAgICAgICAnY29sdW1uV3JhcHBlclN0eWxlIG5vdCBzdXBwb3J0ZWQgZm9yIHNpbmdsZSBjb2x1bW4gbGlzdHMnLFxuICAgICAgKTtcbiAgICB9XG4gICAgaW52YXJpYW50KFxuICAgICAgIShvblZpZXdhYmxlSXRlbXNDaGFuZ2VkICYmIHZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycyksXG4gICAgICAnRmxhdExpc3QgZG9lcyBub3Qgc3VwcG9ydCBzZXR0aW5nIGJvdGggb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZCBhbmQgJyArXG4gICAgICAgICd2aWV3YWJpbGl0eUNvbmZpZ0NhbGxiYWNrUGFpcnMuJyxcbiAgICApO1xuICB9XG5cbiAgX2dldEl0ZW0gPSAoZGF0YTogQXJyYXk8SXRlbVQ+LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgY29uc3Qge251bUNvbHVtbnN9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobnVtQ29sdW1ucyA+IDEpIHtcbiAgICAgIGNvbnN0IHJldCA9IFtdO1xuICAgICAgZm9yIChsZXQga2sgPSAwOyBrayA8IG51bUNvbHVtbnM7IGtrKyspIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IGRhdGFbaW5kZXggKiBudW1Db2x1bW5zICsga2tdO1xuICAgICAgICBpZiAoaXRlbSAhPSBudWxsKSB7XG4gICAgICAgICAgcmV0LnB1c2goaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBkYXRhW2luZGV4XTtcbiAgICB9XG4gIH07XG5cbiAgX2dldEl0ZW1Db3VudCA9IChkYXRhOiA/QXJyYXk8SXRlbVQ+KTogbnVtYmVyID0+IHtcbiAgICBpZiAoZGF0YSkge1xuICAgICAgY29uc3Qge251bUNvbHVtbnN9ID0gdGhpcy5wcm9wcztcbiAgICAgIHJldHVybiBudW1Db2x1bW5zID4gMSA/IE1hdGguY2VpbChkYXRhLmxlbmd0aCAvIG51bUNvbHVtbnMpIDogZGF0YS5sZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfTtcblxuICBfa2V5RXh0cmFjdG9yID0gKGl0ZW1zOiBJdGVtVCB8IEFycmF5PEl0ZW1UPiwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHtrZXlFeHRyYWN0b3IsIG51bUNvbHVtbnN9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAobnVtQ29sdW1ucyA+IDEpIHtcbiAgICAgIGludmFyaWFudChcbiAgICAgICAgQXJyYXkuaXNBcnJheShpdGVtcyksXG4gICAgICAgICdGbGF0TGlzdDogRW5jb3VudGVyZWQgaW50ZXJuYWwgY29uc2lzdGVuY3kgZXJyb3IsIGV4cGVjdGVkIGVhY2ggaXRlbSB0byBjb25zaXN0IG9mIGFuICcgK1xuICAgICAgICAgICdhcnJheSB3aXRoIDEtJXMgY29sdW1uczsgaW5zdGVhZCwgcmVjZWl2ZWQgYSBzaW5nbGUgaXRlbS4nLFxuICAgICAgICBudW1Db2x1bW5zLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBpdGVtc1xuICAgICAgICAubWFwKChpdCwga2spID0+IGtleUV4dHJhY3RvcihpdCwgaW5kZXggKiBudW1Db2x1bW5zICsga2spKVxuICAgICAgICAuam9pbignOicpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyAkRmxvd0ZpeE1lIENhbid0IGNhbGwga2V5RXh0cmFjdG9yIHdpdGggYW4gYXJyYXlcbiAgICAgIHJldHVybiBrZXlFeHRyYWN0b3IoaXRlbXMsIGluZGV4KTtcbiAgICB9XG4gIH07XG5cbiAgX3B1c2hNdWx0aUNvbHVtblZpZXdhYmxlKGFycjogQXJyYXk8Vmlld1Rva2VuPiwgdjogVmlld1Rva2VuKTogdm9pZCB7XG4gICAgY29uc3Qge251bUNvbHVtbnMsIGtleUV4dHJhY3Rvcn0gPSB0aGlzLnByb3BzO1xuICAgIHYuaXRlbS5mb3JFYWNoKChpdGVtLCBpaSkgPT4ge1xuICAgICAgaW52YXJpYW50KHYuaW5kZXggIT0gbnVsbCwgJ01pc3NpbmcgaW5kZXghJyk7XG4gICAgICBjb25zdCBpbmRleCA9IHYuaW5kZXggKiBudW1Db2x1bW5zICsgaWk7XG4gICAgICBhcnIucHVzaCh7Li4udiwgaXRlbSwga2V5OiBrZXlFeHRyYWN0b3IoaXRlbSwgaW5kZXgpLCBpbmRleH0pO1xuICAgIH0pO1xuICB9XG5cbiAgX2NyZWF0ZU9uVmlld2FibGVJdGVtc0NoYW5nZWQoXG4gICAgb25WaWV3YWJsZUl0ZW1zQ2hhbmdlZDogPyhpbmZvOiB7XG4gICAgICB2aWV3YWJsZUl0ZW1zOiBBcnJheTxWaWV3VG9rZW4+LFxuICAgICAgY2hhbmdlZDogQXJyYXk8Vmlld1Rva2VuPixcbiAgICAgIC4uLlxuICAgIH0pID0+IHZvaWQsXG4gICkge1xuICAgIHJldHVybiAoaW5mbzoge1xuICAgICAgdmlld2FibGVJdGVtczogQXJyYXk8Vmlld1Rva2VuPixcbiAgICAgIGNoYW5nZWQ6IEFycmF5PFZpZXdUb2tlbj4sXG4gICAgICAuLi5cbiAgICB9KSA9PiB7XG4gICAgICBjb25zdCB7bnVtQ29sdW1uc30gPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKG9uVmlld2FibGVJdGVtc0NoYW5nZWQpIHtcbiAgICAgICAgaWYgKG51bUNvbHVtbnMgPiAxKSB7XG4gICAgICAgICAgY29uc3QgY2hhbmdlZCA9IFtdO1xuICAgICAgICAgIGNvbnN0IHZpZXdhYmxlSXRlbXMgPSBbXTtcbiAgICAgICAgICBpbmZvLnZpZXdhYmxlSXRlbXMuZm9yRWFjaCh2ID0+XG4gICAgICAgICAgICB0aGlzLl9wdXNoTXVsdGlDb2x1bW5WaWV3YWJsZSh2aWV3YWJsZUl0ZW1zLCB2KSxcbiAgICAgICAgICApO1xuICAgICAgICAgIGluZm8uY2hhbmdlZC5mb3JFYWNoKHYgPT4gdGhpcy5fcHVzaE11bHRpQ29sdW1uVmlld2FibGUoY2hhbmdlZCwgdikpO1xuICAgICAgICAgIG9uVmlld2FibGVJdGVtc0NoYW5nZWQoe3ZpZXdhYmxlSXRlbXMsIGNoYW5nZWR9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvblZpZXdhYmxlSXRlbXNDaGFuZ2VkKGluZm8pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIF9yZW5kZXJlciA9ICgpID0+IHtcbiAgICBjb25zdCB7XG4gICAgICBMaXN0SXRlbUNvbXBvbmVudCxcbiAgICAgIHJlbmRlckl0ZW0sXG4gICAgICBudW1Db2x1bW5zLFxuICAgICAgY29sdW1uV3JhcHBlclN0eWxlLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgbGV0IHZpcnR1YWxpemVkTGlzdFJlbmRlcktleSA9IExpc3RJdGVtQ29tcG9uZW50XG4gICAgICA/ICdMaXN0SXRlbUNvbXBvbmVudCdcbiAgICAgIDogJ3JlbmRlckl0ZW0nO1xuXG4gICAgY29uc3QgcmVuZGVyZXIgPSAocHJvcHMpOiBSZWFjdC5Ob2RlID0+IHtcbiAgICAgIGlmIChMaXN0SXRlbUNvbXBvbmVudCkge1xuICAgICAgICAvLyAkRmxvd0ZpeE1lIENvbXBvbmVudCBpc24ndCB2YWxpZFxuICAgICAgICByZXR1cm4gPExpc3RJdGVtQ29tcG9uZW50IHsuLi5wcm9wc30gLz47XG4gICAgICB9IGVsc2UgaWYgKHJlbmRlckl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIHJlbmRlckl0ZW0ocHJvcHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAvKiAkRmxvd0ZpeE1lKD49MC4xMTEuMCBzaXRlPXJlYWN0X25hdGl2ZV9mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAgICAgICAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC4xMTEgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGVcbiAgICAgICAqIHRoaXMgY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG4gICAgICBbdmlydHVhbGl6ZWRMaXN0UmVuZGVyS2V5XTogKGluZm86IFJlbmRlckl0ZW1Qcm9wczxJdGVtVD4pID0+IHtcbiAgICAgICAgaWYgKG51bUNvbHVtbnMgPiAxKSB7XG4gICAgICAgICAgY29uc3Qge2l0ZW0sIGluZGV4fSA9IGluZm87XG4gICAgICAgICAgaW52YXJpYW50KFxuICAgICAgICAgICAgQXJyYXkuaXNBcnJheShpdGVtKSxcbiAgICAgICAgICAgICdFeHBlY3RlZCBhcnJheSBvZiBpdGVtcyB3aXRoIG51bUNvbHVtbnMgPiAxJyxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8VmlldyBzdHlsZT17U3R5bGVTaGVldC5jb21wb3NlKHN0eWxlcy5yb3csIGNvbHVtbldyYXBwZXJTdHlsZSl9PlxuICAgICAgICAgICAgICB7aXRlbS5tYXAoKGl0LCBraykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSByZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICBpdGVtOiBpdCxcbiAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleCAqIG51bUNvbHVtbnMgKyBrayxcbiAgICAgICAgICAgICAgICAgIHNlcGFyYXRvcnM6IGluZm8uc2VwYXJhdG9ycyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudCAhPSBudWxsID8gKFxuICAgICAgICAgICAgICAgICAgPFJlYWN0LkZyYWdtZW50IGtleT17a2t9PntlbGVtZW50fTwvUmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgICAgICAgKSA6IG51bGw7XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9WaWV3PlxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHJlbmRlcmVyKGluZm8pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH07XG4gIH07XG5cbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xuICAgIGNvbnN0IHtudW1Db2x1bW5zLCBjb2x1bW5XcmFwcGVyU3R5bGUsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaXJ0dWFsaXplZExpc3RcbiAgICAgICAgey4uLnJlc3RQcm9wc31cbiAgICAgICAgZ2V0SXRlbT17dGhpcy5fZ2V0SXRlbX1cbiAgICAgICAgZ2V0SXRlbUNvdW50PXt0aGlzLl9nZXRJdGVtQ291bnR9XG4gICAgICAgIGtleUV4dHJhY3Rvcj17dGhpcy5fa2V5RXh0cmFjdG9yfVxuICAgICAgICByZWY9e3RoaXMuX2NhcHR1cmVSZWZ9XG4gICAgICAgIHZpZXdhYmlsaXR5Q29uZmlnQ2FsbGJhY2tQYWlycz17dGhpcy5fdmlydHVhbGl6ZWRMaXN0UGFpcnN9XG4gICAgICAgIHsuLi50aGlzLl9yZW5kZXJlcigpfVxuICAgICAgLz5cbiAgICApO1xuICB9XG59XG5cbmNvbnN0IHN0eWxlcyA9IFN0eWxlU2hlZXQuY3JlYXRlKHtcbiAgcm93OiB7ZmxleERpcmVjdGlvbjogJ3Jvdyd9LFxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gRmxhdExpc3Q7XG4iXX0=