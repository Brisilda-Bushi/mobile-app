9dc85986d4919a3abb552e0b023c1c2a
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var url = require("url");

var URL = url.URL;

var http = require("http");

var https = require("https");

var Writable = require("stream").Writable;

var assert = require("assert");

var debug = require("./debug");

var events = ["abort", "aborted", "connect", "error", "socket", "timeout"];
var eventHandlers = Object.create(null);
events.forEach(function (event) {
  eventHandlers[event] = function (arg1, arg2, arg3) {
    this._redirectable.emit(event, arg1, arg2, arg3);
  };
});
var RedirectionError = createErrorType("ERR_FR_REDIRECTION_FAILURE", "Redirected request failed");
var TooManyRedirectsError = createErrorType("ERR_FR_TOO_MANY_REDIRECTS", "Maximum number of redirects exceeded");
var MaxBodyLengthExceededError = createErrorType("ERR_FR_MAX_BODY_LENGTH_EXCEEDED", "Request body larger than maxBodyLength limit");
var WriteAfterEndError = createErrorType("ERR_STREAM_WRITE_AFTER_END", "write after end");

function RedirectableRequest(options, responseCallback) {
  Writable.call(this);

  this._sanitizeOptions(options);

  this._options = options;
  this._ended = false;
  this._ending = false;
  this._redirectCount = 0;
  this._redirects = [];
  this._requestBodyLength = 0;
  this._requestBodyBuffers = [];

  if (responseCallback) {
    this.on("response", responseCallback);
  }

  var self = this;

  this._onNativeResponse = function (response) {
    self._processResponse(response);
  };

  this._performRequest();
}

RedirectableRequest.prototype = Object.create(Writable.prototype);

RedirectableRequest.prototype.abort = function () {
  abortRequest(this._currentRequest);
  this.emit("abort");
};

RedirectableRequest.prototype.write = function (data, encoding, callback) {
  if (this._ending) {
    throw new WriteAfterEndError();
  }

  if (!(typeof data === "string" || typeof data === "object" && "length" in data)) {
    throw new TypeError("data should be a string, Buffer or Uint8Array");
  }

  if (typeof encoding === "function") {
    callback = encoding;
    encoding = null;
  }

  if (data.length === 0) {
    if (callback) {
      callback();
    }

    return;
  }

  if (this._requestBodyLength + data.length <= this._options.maxBodyLength) {
    this._requestBodyLength += data.length;

    this._requestBodyBuffers.push({
      data: data,
      encoding: encoding
    });

    this._currentRequest.write(data, encoding, callback);
  } else {
    this.emit("error", new MaxBodyLengthExceededError());
    this.abort();
  }
};

RedirectableRequest.prototype.end = function (data, encoding, callback) {
  if (typeof data === "function") {
    callback = data;
    data = encoding = null;
  } else if (typeof encoding === "function") {
    callback = encoding;
    encoding = null;
  }

  if (!data) {
    this._ended = this._ending = true;

    this._currentRequest.end(null, null, callback);
  } else {
    var self = this;
    var currentRequest = this._currentRequest;
    this.write(data, encoding, function () {
      self._ended = true;
      currentRequest.end(null, null, callback);
    });
    this._ending = true;
  }
};

RedirectableRequest.prototype.setHeader = function (name, value) {
  this._options.headers[name] = value;

  this._currentRequest.setHeader(name, value);
};

RedirectableRequest.prototype.removeHeader = function (name) {
  delete this._options.headers[name];

  this._currentRequest.removeHeader(name);
};

RedirectableRequest.prototype.setTimeout = function (msecs, callback) {
  var self = this;

  function destroyOnTimeout(socket) {
    socket.setTimeout(msecs);
    socket.removeListener("timeout", socket.destroy);
    socket.addListener("timeout", socket.destroy);
  }

  function startTimer(socket) {
    if (self._timeout) {
      clearTimeout(self._timeout);
    }

    self._timeout = setTimeout(function () {
      self.emit("timeout");
      clearTimer();
    }, msecs);
    destroyOnTimeout(socket);
  }

  function clearTimer() {
    if (self._timeout) {
      clearTimeout(self._timeout);
      self._timeout = null;
    }

    self.removeListener("abort", clearTimer);
    self.removeListener("error", clearTimer);
    self.removeListener("response", clearTimer);

    if (callback) {
      self.removeListener("timeout", callback);
    }

    if (!self.socket) {
      self._currentRequest.removeListener("socket", startTimer);
    }
  }

  if (callback) {
    this.on("timeout", callback);
  }

  if (this.socket) {
    startTimer(this.socket);
  } else {
    this._currentRequest.once("socket", startTimer);
  }

  this.on("socket", destroyOnTimeout);
  this.on("abort", clearTimer);
  this.on("error", clearTimer);
  this.on("response", clearTimer);
  return this;
};

["flushHeaders", "getHeader", "setNoDelay", "setSocketKeepAlive"].forEach(function (method) {
  RedirectableRequest.prototype[method] = function (a, b) {
    return this._currentRequest[method](a, b);
  };
});
["aborted", "connection", "socket"].forEach(function (property) {
  Object.defineProperty(RedirectableRequest.prototype, property, {
    get: function get() {
      return this._currentRequest[property];
    }
  });
});

RedirectableRequest.prototype._sanitizeOptions = function (options) {
  if (!options.headers) {
    options.headers = {};
  }

  if (options.host) {
    if (!options.hostname) {
      options.hostname = options.host;
    }

    delete options.host;
  }

  if (!options.pathname && options.path) {
    var searchPos = options.path.indexOf("?");

    if (searchPos < 0) {
      options.pathname = options.path;
    } else {
      options.pathname = options.path.substring(0, searchPos);
      options.search = options.path.substring(searchPos);
    }
  }
};

RedirectableRequest.prototype._performRequest = function () {
  var protocol = this._options.protocol;
  var nativeProtocol = this._options.nativeProtocols[protocol];

  if (!nativeProtocol) {
    this.emit("error", new TypeError("Unsupported protocol " + protocol));
    return;
  }

  if (this._options.agents) {
    var scheme = protocol.substr(0, protocol.length - 1);
    this._options.agent = this._options.agents[scheme];
  }

  var request = this._currentRequest = nativeProtocol.request(this._options, this._onNativeResponse);
  this._currentUrl = url.format(this._options);
  request._redirectable = this;

  for (var e = 0; e < events.length; e++) {
    request.on(events[e], eventHandlers[events[e]]);
  }

  if (this._isRedirect) {
    var i = 0;
    var self = this;
    var buffers = this._requestBodyBuffers;

    (function writeNext(error) {
      if (request === self._currentRequest) {
        if (error) {
          self.emit("error", error);
        } else if (i < buffers.length) {
          var buffer = buffers[i++];

          if (!request.finished) {
            request.write(buffer.data, buffer.encoding, writeNext);
          }
        } else if (self._ended) {
          request.end();
        }
      }
    })();
  }
};

RedirectableRequest.prototype._processResponse = function (response) {
  var statusCode = response.statusCode;

  if (this._options.trackRedirects) {
    this._redirects.push({
      url: this._currentUrl,
      headers: response.headers,
      statusCode: statusCode
    });
  }

  var location = response.headers.location;

  if (location && this._options.followRedirects !== false && statusCode >= 300 && statusCode < 400) {
    abortRequest(this._currentRequest);
    response.destroy();

    if (++this._redirectCount > this._options.maxRedirects) {
      this.emit("error", new TooManyRedirectsError());
      return;
    }

    if ((statusCode === 301 || statusCode === 302) && this._options.method === "POST" || statusCode === 303 && !/^(?:GET|HEAD)$/.test(this._options.method)) {
      this._options.method = "GET";
      this._requestBodyBuffers = [];
      removeMatchingHeaders(/^content-/i, this._options.headers);
    }

    var currentHostHeader = removeMatchingHeaders(/^host$/i, this._options.headers);
    var currentUrlParts = url.parse(this._currentUrl);
    var currentHost = currentHostHeader || currentUrlParts.host;
    var currentUrl = /^\w+:/.test(location) ? this._currentUrl : url.format((0, _extends2.default)(currentUrlParts, {
      host: currentHost
    }));
    var redirectUrl;

    try {
      redirectUrl = url.resolve(currentUrl, location);
    } catch (cause) {
      this.emit("error", new RedirectionError(cause));
      return;
    }

    debug("redirecting to", redirectUrl);
    this._isRedirect = true;
    var redirectUrlParts = url.parse(redirectUrl);
    (0, _extends2.default)(this._options, redirectUrlParts);

    if (!(redirectUrlParts.host === currentHost || isSubdomainOf(redirectUrlParts.host, currentHost))) {
      removeMatchingHeaders(/^authorization$/i, this._options.headers);
    }

    if (typeof this._options.beforeRedirect === "function") {
      var responseDetails = {
        headers: response.headers
      };

      try {
        this._options.beforeRedirect.call(null, this._options, responseDetails);
      } catch (err) {
        this.emit("error", err);
        return;
      }

      this._sanitizeOptions(this._options);
    }

    try {
      this._performRequest();
    } catch (cause) {
      this.emit("error", new RedirectionError(cause));
    }
  } else {
    response.responseUrl = this._currentUrl;
    response.redirects = this._redirects;
    this.emit("response", response);
    this._requestBodyBuffers = [];
  }
};

function wrap(protocols) {
  var exports = {
    maxRedirects: 21,
    maxBodyLength: 10 * 1024 * 1024
  };
  var nativeProtocols = {};
  Object.keys(protocols).forEach(function (scheme) {
    var protocol = scheme + ":";
    var nativeProtocol = nativeProtocols[protocol] = protocols[scheme];
    var wrappedProtocol = exports[scheme] = Object.create(nativeProtocol);

    function request(input, options, callback) {
      if (typeof input === "string") {
        var urlStr = input;

        try {
          input = urlToOptions(new URL(urlStr));
        } catch (err) {
          input = url.parse(urlStr);
        }
      } else if (URL && input instanceof URL) {
        input = urlToOptions(input);
      } else {
        callback = options;
        options = input;
        input = {
          protocol: protocol
        };
      }

      if (typeof options === "function") {
        callback = options;
        options = null;
      }

      options = (0, _extends2.default)({
        maxRedirects: exports.maxRedirects,
        maxBodyLength: exports.maxBodyLength
      }, input, options);
      options.nativeProtocols = nativeProtocols;
      assert.equal(options.protocol, protocol, "protocol mismatch");
      debug("options", options);
      return new RedirectableRequest(options, callback);
    }

    function get(input, options, callback) {
      var wrappedRequest = wrappedProtocol.request(input, options, callback);
      wrappedRequest.end();
      return wrappedRequest;
    }

    Object.defineProperties(wrappedProtocol, {
      request: {
        value: request,
        configurable: true,
        enumerable: true,
        writable: true
      },
      get: {
        value: get,
        configurable: true,
        enumerable: true,
        writable: true
      }
    });
  });
  return exports;
}

function noop() {}

function urlToOptions(urlObject) {
  var options = {
    protocol: urlObject.protocol,
    hostname: urlObject.hostname.startsWith("[") ? urlObject.hostname.slice(1, -1) : urlObject.hostname,
    hash: urlObject.hash,
    search: urlObject.search,
    pathname: urlObject.pathname,
    path: urlObject.pathname + urlObject.search,
    href: urlObject.href
  };

  if (urlObject.port !== "") {
    options.port = Number(urlObject.port);
  }

  return options;
}

function removeMatchingHeaders(regex, headers) {
  var lastValue;

  for (var header in headers) {
    if (regex.test(header)) {
      lastValue = headers[header];
      delete headers[header];
    }
  }

  return lastValue === null || typeof lastValue === "undefined" ? undefined : String(lastValue).trim();
}

function createErrorType(code, defaultMessage) {
  function CustomError(cause) {
    Error.captureStackTrace(this, this.constructor);

    if (!cause) {
      this.message = defaultMessage;
    } else {
      this.message = defaultMessage + ": " + cause.message;
      this.cause = cause;
    }
  }

  CustomError.prototype = new Error();
  CustomError.prototype.constructor = CustomError;
  CustomError.prototype.name = "Error [" + code + "]";
  CustomError.prototype.code = code;
  return CustomError;
}

function abortRequest(request) {
  for (var e = 0; e < events.length; e++) {
    request.removeListener(events[e], eventHandlers[events[e]]);
  }

  request.on("error", noop);
  request.abort();
}

function isSubdomainOf(subdomain, domain) {
  var dot = subdomain.length - domain.length - 1;
  return dot > 0 && subdomain[dot] === "." && subdomain.endsWith(domain);
}

module.exports = wrap({
  http: http,
  https: https
});
module.exports.wrap = wrap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInVybCIsInJlcXVpcmUiLCJVUkwiLCJodHRwIiwiaHR0cHMiLCJXcml0YWJsZSIsImFzc2VydCIsImRlYnVnIiwiZXZlbnRzIiwiZXZlbnRIYW5kbGVycyIsIk9iamVjdCIsImNyZWF0ZSIsImZvckVhY2giLCJldmVudCIsImFyZzEiLCJhcmcyIiwiYXJnMyIsIl9yZWRpcmVjdGFibGUiLCJlbWl0IiwiUmVkaXJlY3Rpb25FcnJvciIsImNyZWF0ZUVycm9yVHlwZSIsIlRvb01hbnlSZWRpcmVjdHNFcnJvciIsIk1heEJvZHlMZW5ndGhFeGNlZWRlZEVycm9yIiwiV3JpdGVBZnRlckVuZEVycm9yIiwiUmVkaXJlY3RhYmxlUmVxdWVzdCIsIm9wdGlvbnMiLCJyZXNwb25zZUNhbGxiYWNrIiwiY2FsbCIsIl9zYW5pdGl6ZU9wdGlvbnMiLCJfb3B0aW9ucyIsIl9lbmRlZCIsIl9lbmRpbmciLCJfcmVkaXJlY3RDb3VudCIsIl9yZWRpcmVjdHMiLCJfcmVxdWVzdEJvZHlMZW5ndGgiLCJfcmVxdWVzdEJvZHlCdWZmZXJzIiwib24iLCJzZWxmIiwiX29uTmF0aXZlUmVzcG9uc2UiLCJyZXNwb25zZSIsIl9wcm9jZXNzUmVzcG9uc2UiLCJfcGVyZm9ybVJlcXVlc3QiLCJwcm90b3R5cGUiLCJhYm9ydCIsImFib3J0UmVxdWVzdCIsIl9jdXJyZW50UmVxdWVzdCIsIndyaXRlIiwiZGF0YSIsImVuY29kaW5nIiwiY2FsbGJhY2siLCJUeXBlRXJyb3IiLCJsZW5ndGgiLCJtYXhCb2R5TGVuZ3RoIiwicHVzaCIsImVuZCIsImN1cnJlbnRSZXF1ZXN0Iiwic2V0SGVhZGVyIiwibmFtZSIsInZhbHVlIiwiaGVhZGVycyIsInJlbW92ZUhlYWRlciIsInNldFRpbWVvdXQiLCJtc2VjcyIsImRlc3Ryb3lPblRpbWVvdXQiLCJzb2NrZXQiLCJyZW1vdmVMaXN0ZW5lciIsImRlc3Ryb3kiLCJhZGRMaXN0ZW5lciIsInN0YXJ0VGltZXIiLCJfdGltZW91dCIsImNsZWFyVGltZW91dCIsImNsZWFyVGltZXIiLCJvbmNlIiwibWV0aG9kIiwiYSIsImIiLCJwcm9wZXJ0eSIsImRlZmluZVByb3BlcnR5IiwiZ2V0IiwiaG9zdCIsImhvc3RuYW1lIiwicGF0aG5hbWUiLCJwYXRoIiwic2VhcmNoUG9zIiwiaW5kZXhPZiIsInN1YnN0cmluZyIsInNlYXJjaCIsInByb3RvY29sIiwibmF0aXZlUHJvdG9jb2wiLCJuYXRpdmVQcm90b2NvbHMiLCJhZ2VudHMiLCJzY2hlbWUiLCJzdWJzdHIiLCJhZ2VudCIsInJlcXVlc3QiLCJfY3VycmVudFVybCIsImZvcm1hdCIsImUiLCJfaXNSZWRpcmVjdCIsImkiLCJidWZmZXJzIiwid3JpdGVOZXh0IiwiZXJyb3IiLCJidWZmZXIiLCJmaW5pc2hlZCIsInN0YXR1c0NvZGUiLCJ0cmFja1JlZGlyZWN0cyIsImxvY2F0aW9uIiwiZm9sbG93UmVkaXJlY3RzIiwibWF4UmVkaXJlY3RzIiwidGVzdCIsInJlbW92ZU1hdGNoaW5nSGVhZGVycyIsImN1cnJlbnRIb3N0SGVhZGVyIiwiY3VycmVudFVybFBhcnRzIiwicGFyc2UiLCJjdXJyZW50SG9zdCIsImN1cnJlbnRVcmwiLCJyZWRpcmVjdFVybCIsInJlc29sdmUiLCJjYXVzZSIsInJlZGlyZWN0VXJsUGFydHMiLCJpc1N1YmRvbWFpbk9mIiwiYmVmb3JlUmVkaXJlY3QiLCJyZXNwb25zZURldGFpbHMiLCJlcnIiLCJyZXNwb25zZVVybCIsInJlZGlyZWN0cyIsIndyYXAiLCJwcm90b2NvbHMiLCJleHBvcnRzIiwia2V5cyIsIndyYXBwZWRQcm90b2NvbCIsImlucHV0IiwidXJsU3RyIiwidXJsVG9PcHRpb25zIiwiZXF1YWwiLCJ3cmFwcGVkUmVxdWVzdCIsImRlZmluZVByb3BlcnRpZXMiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwid3JpdGFibGUiLCJub29wIiwidXJsT2JqZWN0Iiwic3RhcnRzV2l0aCIsInNsaWNlIiwiaGFzaCIsImhyZWYiLCJwb3J0IiwiTnVtYmVyIiwicmVnZXgiLCJsYXN0VmFsdWUiLCJoZWFkZXIiLCJ1bmRlZmluZWQiLCJTdHJpbmciLCJ0cmltIiwiY29kZSIsImRlZmF1bHRNZXNzYWdlIiwiQ3VzdG9tRXJyb3IiLCJFcnJvciIsImNhcHR1cmVTdGFja1RyYWNlIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlIiwic3ViZG9tYWluIiwiZG9tYWluIiwiZG90IiwiZW5kc1dpdGgiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxJQUFJQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxLQUFELENBQWpCOztBQUNBLElBQUlDLEdBQUcsR0FBR0YsR0FBRyxDQUFDRSxHQUFkOztBQUNBLElBQUlDLElBQUksR0FBR0YsT0FBTyxDQUFDLE1BQUQsQ0FBbEI7O0FBQ0EsSUFBSUcsS0FBSyxHQUFHSCxPQUFPLENBQUMsT0FBRCxDQUFuQjs7QUFDQSxJQUFJSSxRQUFRLEdBQUdKLE9BQU8sQ0FBQyxRQUFELENBQVAsQ0FBa0JJLFFBQWpDOztBQUNBLElBQUlDLE1BQU0sR0FBR0wsT0FBTyxDQUFDLFFBQUQsQ0FBcEI7O0FBQ0EsSUFBSU0sS0FBSyxHQUFHTixPQUFPLFdBQW5COztBQUdBLElBQUlPLE1BQU0sR0FBRyxDQUFDLE9BQUQsRUFBVSxTQUFWLEVBQXFCLFNBQXJCLEVBQWdDLE9BQWhDLEVBQXlDLFFBQXpDLEVBQW1ELFNBQW5ELENBQWI7QUFDQSxJQUFJQyxhQUFhLEdBQUdDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLElBQWQsQ0FBcEI7QUFDQUgsTUFBTSxDQUFDSSxPQUFQLENBQWUsVUFBVUMsS0FBVixFQUFpQjtBQUM5QkosRUFBQUEsYUFBYSxDQUFDSSxLQUFELENBQWIsR0FBdUIsVUFBVUMsSUFBVixFQUFnQkMsSUFBaEIsRUFBc0JDLElBQXRCLEVBQTRCO0FBQ2pELFNBQUtDLGFBQUwsQ0FBbUJDLElBQW5CLENBQXdCTCxLQUF4QixFQUErQkMsSUFBL0IsRUFBcUNDLElBQXJDLEVBQTJDQyxJQUEzQztBQUNELEdBRkQ7QUFHRCxD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dCI6WyJ2YXIgdXJsID0gcmVxdWlyZShcInVybFwiKTtcbnZhciBVUkwgPSB1cmwuVVJMO1xudmFyIGh0dHAgPSByZXF1aXJlKFwiaHR0cFwiKTtcbnZhciBodHRwcyA9IHJlcXVpcmUoXCJodHRwc1wiKTtcbnZhciBXcml0YWJsZSA9IHJlcXVpcmUoXCJzdHJlYW1cIikuV3JpdGFibGU7XG52YXIgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcbnZhciBkZWJ1ZyA9IHJlcXVpcmUoXCIuL2RlYnVnXCIpO1xuXG4vLyBDcmVhdGUgaGFuZGxlcnMgdGhhdCBwYXNzIGV2ZW50cyBmcm9tIG5hdGl2ZSByZXF1ZXN0c1xudmFyIGV2ZW50cyA9IFtcImFib3J0XCIsIFwiYWJvcnRlZFwiLCBcImNvbm5lY3RcIiwgXCJlcnJvclwiLCBcInNvY2tldFwiLCBcInRpbWVvdXRcIl07XG52YXIgZXZlbnRIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5ldmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgZXZlbnRIYW5kbGVyc1tldmVudF0gPSBmdW5jdGlvbiAoYXJnMSwgYXJnMiwgYXJnMykge1xuICAgIHRoaXMuX3JlZGlyZWN0YWJsZS5lbWl0KGV2ZW50LCBhcmcxLCBhcmcyLCBhcmczKTtcbiAgfTtcbn0pO1xuXG4vLyBFcnJvciB0eXBlcyB3aXRoIGNvZGVzXG52YXIgUmVkaXJlY3Rpb25FcnJvciA9IGNyZWF0ZUVycm9yVHlwZShcbiAgXCJFUlJfRlJfUkVESVJFQ1RJT05fRkFJTFVSRVwiLFxuICBcIlJlZGlyZWN0ZWQgcmVxdWVzdCBmYWlsZWRcIlxuKTtcbnZhciBUb29NYW55UmVkaXJlY3RzRXJyb3IgPSBjcmVhdGVFcnJvclR5cGUoXG4gIFwiRVJSX0ZSX1RPT19NQU5ZX1JFRElSRUNUU1wiLFxuICBcIk1heGltdW0gbnVtYmVyIG9mIHJlZGlyZWN0cyBleGNlZWRlZFwiXG4pO1xudmFyIE1heEJvZHlMZW5ndGhFeGNlZWRlZEVycm9yID0gY3JlYXRlRXJyb3JUeXBlKFxuICBcIkVSUl9GUl9NQVhfQk9EWV9MRU5HVEhfRVhDRUVERURcIixcbiAgXCJSZXF1ZXN0IGJvZHkgbGFyZ2VyIHRoYW4gbWF4Qm9keUxlbmd0aCBsaW1pdFwiXG4pO1xudmFyIFdyaXRlQWZ0ZXJFbmRFcnJvciA9IGNyZWF0ZUVycm9yVHlwZShcbiAgXCJFUlJfU1RSRUFNX1dSSVRFX0FGVEVSX0VORFwiLFxuICBcIndyaXRlIGFmdGVyIGVuZFwiXG4pO1xuXG4vLyBBbiBIVFRQKFMpIHJlcXVlc3QgdGhhdCBjYW4gYmUgcmVkaXJlY3RlZFxuZnVuY3Rpb24gUmVkaXJlY3RhYmxlUmVxdWVzdChvcHRpb25zLCByZXNwb25zZUNhbGxiYWNrKSB7XG4gIC8vIEluaXRpYWxpemUgdGhlIHJlcXVlc3RcbiAgV3JpdGFibGUuY2FsbCh0aGlzKTtcbiAgdGhpcy5fc2FuaXRpemVPcHRpb25zKG9wdGlvbnMpO1xuICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcbiAgdGhpcy5fZW5kZWQgPSBmYWxzZTtcbiAgdGhpcy5fZW5kaW5nID0gZmFsc2U7XG4gIHRoaXMuX3JlZGlyZWN0Q291bnQgPSAwO1xuICB0aGlzLl9yZWRpcmVjdHMgPSBbXTtcbiAgdGhpcy5fcmVxdWVzdEJvZHlMZW5ndGggPSAwO1xuICB0aGlzLl9yZXF1ZXN0Qm9keUJ1ZmZlcnMgPSBbXTtcblxuICAvLyBBdHRhY2ggYSBjYWxsYmFjayBpZiBwYXNzZWRcbiAgaWYgKHJlc3BvbnNlQ2FsbGJhY2spIHtcbiAgICB0aGlzLm9uKFwicmVzcG9uc2VcIiwgcmVzcG9uc2VDYWxsYmFjayk7XG4gIH1cblxuICAvLyBSZWFjdCB0byByZXNwb25zZXMgb2YgbmF0aXZlIHJlcXVlc3RzXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5fb25OYXRpdmVSZXNwb25zZSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgIHNlbGYuX3Byb2Nlc3NSZXNwb25zZShyZXNwb25zZSk7XG4gIH07XG5cbiAgLy8gUGVyZm9ybSB0aGUgZmlyc3QgcmVxdWVzdFxuICB0aGlzLl9wZXJmb3JtUmVxdWVzdCgpO1xufVxuUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFdyaXRhYmxlLnByb3RvdHlwZSk7XG5cblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLmFib3J0ID0gZnVuY3Rpb24gKCkge1xuICBhYm9ydFJlcXVlc3QodGhpcy5fY3VycmVudFJlcXVlc3QpO1xuICB0aGlzLmVtaXQoXCJhYm9ydFwiKTtcbn07XG5cbi8vIFdyaXRlcyBidWZmZXJlZCBkYXRhIHRvIHRoZSBjdXJyZW50IG5hdGl2ZSByZXF1ZXN0XG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIChkYXRhLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbiAgLy8gV3JpdGluZyBpcyBub3QgYWxsb3dlZCBpZiBlbmQgaGFzIGJlZW4gY2FsbGVkXG4gIGlmICh0aGlzLl9lbmRpbmcpIHtcbiAgICB0aHJvdyBuZXcgV3JpdGVBZnRlckVuZEVycm9yKCk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBpbnB1dCBhbmQgc2hpZnQgcGFyYW1ldGVycyBpZiBuZWNlc3NhcnlcbiAgaWYgKCEodHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIgJiYgKFwibGVuZ3RoXCIgaW4gZGF0YSkpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcImRhdGEgc2hvdWxkIGJlIGEgc3RyaW5nLCBCdWZmZXIgb3IgVWludDhBcnJheVwiKTtcbiAgfVxuICBpZiAodHlwZW9mIGVuY29kaW5nID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBjYWxsYmFjayA9IGVuY29kaW5nO1xuICAgIGVuY29kaW5nID0gbnVsbDtcbiAgfVxuXG4gIC8vIElnbm9yZSBlbXB0eSBidWZmZXJzLCBzaW5jZSB3cml0aW5nIHRoZW0gZG9lc24ndCBpbnZva2UgdGhlIGNhbGxiYWNrXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS9pc3N1ZXMvMjIwNjZcbiAgaWYgKGRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cbiAgLy8gT25seSB3cml0ZSB3aGVuIHdlIGRvbid0IGV4Y2VlZCB0aGUgbWF4aW11bSBib2R5IGxlbmd0aFxuICBpZiAodGhpcy5fcmVxdWVzdEJvZHlMZW5ndGggKyBkYXRhLmxlbmd0aCA8PSB0aGlzLl9vcHRpb25zLm1heEJvZHlMZW5ndGgpIHtcbiAgICB0aGlzLl9yZXF1ZXN0Qm9keUxlbmd0aCArPSBkYXRhLmxlbmd0aDtcbiAgICB0aGlzLl9yZXF1ZXN0Qm9keUJ1ZmZlcnMucHVzaCh7IGRhdGE6IGRhdGEsIGVuY29kaW5nOiBlbmNvZGluZyB9KTtcbiAgICB0aGlzLl9jdXJyZW50UmVxdWVzdC53cml0ZShkYXRhLCBlbmNvZGluZywgY2FsbGJhY2spO1xuICB9XG4gIC8vIEVycm9yIHdoZW4gd2UgZXhjZWVkIHRoZSBtYXhpbXVtIGJvZHkgbGVuZ3RoXG4gIGVsc2Uge1xuICAgIHRoaXMuZW1pdChcImVycm9yXCIsIG5ldyBNYXhCb2R5TGVuZ3RoRXhjZWVkZWRFcnJvcigpKTtcbiAgICB0aGlzLmFib3J0KCk7XG4gIH1cbn07XG5cbi8vIEVuZHMgdGhlIGN1cnJlbnQgbmF0aXZlIHJlcXVlc3RcblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uIChkYXRhLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbiAgLy8gU2hpZnQgcGFyYW1ldGVycyBpZiBuZWNlc3NhcnlcbiAgaWYgKHR5cGVvZiBkYXRhID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBjYWxsYmFjayA9IGRhdGE7XG4gICAgZGF0YSA9IGVuY29kaW5nID0gbnVsbDtcbiAgfVxuICBlbHNlIGlmICh0eXBlb2YgZW5jb2RpbmcgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGNhbGxiYWNrID0gZW5jb2Rpbmc7XG4gICAgZW5jb2RpbmcgPSBudWxsO1xuICB9XG5cbiAgLy8gV3JpdGUgZGF0YSBpZiBuZWVkZWQgYW5kIGVuZFxuICBpZiAoIWRhdGEpIHtcbiAgICB0aGlzLl9lbmRlZCA9IHRoaXMuX2VuZGluZyA9IHRydWU7XG4gICAgdGhpcy5fY3VycmVudFJlcXVlc3QuZW5kKG51bGwsIG51bGwsIGNhbGxiYWNrKTtcbiAgfVxuICBlbHNlIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGN1cnJlbnRSZXF1ZXN0ID0gdGhpcy5fY3VycmVudFJlcXVlc3Q7XG4gICAgdGhpcy53cml0ZShkYXRhLCBlbmNvZGluZywgZnVuY3Rpb24gKCkge1xuICAgICAgc2VsZi5fZW5kZWQgPSB0cnVlO1xuICAgICAgY3VycmVudFJlcXVlc3QuZW5kKG51bGwsIG51bGwsIGNhbGxiYWNrKTtcbiAgICB9KTtcbiAgICB0aGlzLl9lbmRpbmcgPSB0cnVlO1xuICB9XG59O1xuXG4vLyBTZXRzIGEgaGVhZGVyIHZhbHVlIG9uIHRoZSBjdXJyZW50IG5hdGl2ZSByZXF1ZXN0XG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5zZXRIZWFkZXIgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHtcbiAgdGhpcy5fb3B0aW9ucy5oZWFkZXJzW25hbWVdID0gdmFsdWU7XG4gIHRoaXMuX2N1cnJlbnRSZXF1ZXN0LnNldEhlYWRlcihuYW1lLCB2YWx1ZSk7XG59O1xuXG4vLyBDbGVhcnMgYSBoZWFkZXIgdmFsdWUgb24gdGhlIGN1cnJlbnQgbmF0aXZlIHJlcXVlc3RcblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLnJlbW92ZUhlYWRlciA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gIGRlbGV0ZSB0aGlzLl9vcHRpb25zLmhlYWRlcnNbbmFtZV07XG4gIHRoaXMuX2N1cnJlbnRSZXF1ZXN0LnJlbW92ZUhlYWRlcihuYW1lKTtcbn07XG5cbi8vIEdsb2JhbCB0aW1lb3V0IGZvciBhbGwgdW5kZXJseWluZyByZXF1ZXN0c1xuUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUuc2V0VGltZW91dCA9IGZ1bmN0aW9uIChtc2VjcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gIC8vIERlc3Ryb3lzIHRoZSBzb2NrZXQgb24gdGltZW91dFxuICBmdW5jdGlvbiBkZXN0cm95T25UaW1lb3V0KHNvY2tldCkge1xuICAgIHNvY2tldC5zZXRUaW1lb3V0KG1zZWNzKTtcbiAgICBzb2NrZXQucmVtb3ZlTGlzdGVuZXIoXCJ0aW1lb3V0XCIsIHNvY2tldC5kZXN0cm95KTtcbiAgICBzb2NrZXQuYWRkTGlzdGVuZXIoXCJ0aW1lb3V0XCIsIHNvY2tldC5kZXN0cm95KTtcbiAgfVxuXG4gIC8vIFNldHMgdXAgYSB0aW1lciB0byB0cmlnZ2VyIGEgdGltZW91dCBldmVudFxuICBmdW5jdGlvbiBzdGFydFRpbWVyKHNvY2tldCkge1xuICAgIGlmIChzZWxmLl90aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQoc2VsZi5fdGltZW91dCk7XG4gICAgfVxuICAgIHNlbGYuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHNlbGYuZW1pdChcInRpbWVvdXRcIik7XG4gICAgICBjbGVhclRpbWVyKCk7XG4gICAgfSwgbXNlY3MpO1xuICAgIGRlc3Ryb3lPblRpbWVvdXQoc29ja2V0KTtcbiAgfVxuXG4gIC8vIFN0b3BzIGEgdGltZW91dCBmcm9tIHRyaWdnZXJpbmdcbiAgZnVuY3Rpb24gY2xlYXJUaW1lcigpIHtcbiAgICAvLyBDbGVhciB0aGUgdGltZW91dFxuICAgIGlmIChzZWxmLl90aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQoc2VsZi5fdGltZW91dCk7XG4gICAgICBzZWxmLl90aW1lb3V0ID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBDbGVhbiB1cCBhbGwgYXR0YWNoZWQgbGlzdGVuZXJzXG4gICAgc2VsZi5yZW1vdmVMaXN0ZW5lcihcImFib3J0XCIsIGNsZWFyVGltZXIpO1xuICAgIHNlbGYucmVtb3ZlTGlzdGVuZXIoXCJlcnJvclwiLCBjbGVhclRpbWVyKTtcbiAgICBzZWxmLnJlbW92ZUxpc3RlbmVyKFwicmVzcG9uc2VcIiwgY2xlYXJUaW1lcik7XG4gICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICBzZWxmLnJlbW92ZUxpc3RlbmVyKFwidGltZW91dFwiLCBjYWxsYmFjayk7XG4gICAgfVxuICAgIGlmICghc2VsZi5zb2NrZXQpIHtcbiAgICAgIHNlbGYuX2N1cnJlbnRSZXF1ZXN0LnJlbW92ZUxpc3RlbmVyKFwic29ja2V0XCIsIHN0YXJ0VGltZXIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEF0dGFjaCBjYWxsYmFjayBpZiBwYXNzZWRcbiAgaWYgKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5vbihcInRpbWVvdXRcIiwgY2FsbGJhY2spO1xuICB9XG5cbiAgLy8gU3RhcnQgdGhlIHRpbWVyIGlmIG9yIHdoZW4gdGhlIHNvY2tldCBpcyBvcGVuZWRcbiAgaWYgKHRoaXMuc29ja2V0KSB7XG4gICAgc3RhcnRUaW1lcih0aGlzLnNvY2tldCk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdGhpcy5fY3VycmVudFJlcXVlc3Qub25jZShcInNvY2tldFwiLCBzdGFydFRpbWVyKTtcbiAgfVxuXG4gIC8vIENsZWFuIHVwIG9uIGV2ZW50c1xuICB0aGlzLm9uKFwic29ja2V0XCIsIGRlc3Ryb3lPblRpbWVvdXQpO1xuICB0aGlzLm9uKFwiYWJvcnRcIiwgY2xlYXJUaW1lcik7XG4gIHRoaXMub24oXCJlcnJvclwiLCBjbGVhclRpbWVyKTtcbiAgdGhpcy5vbihcInJlc3BvbnNlXCIsIGNsZWFyVGltZXIpO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuLy8gUHJveHkgYWxsIG90aGVyIHB1YmxpYyBDbGllbnRSZXF1ZXN0IG1ldGhvZHNcbltcbiAgXCJmbHVzaEhlYWRlcnNcIiwgXCJnZXRIZWFkZXJcIixcbiAgXCJzZXROb0RlbGF5XCIsIFwic2V0U29ja2V0S2VlcEFsaXZlXCIsXG5dLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZCkge1xuICBSZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudFJlcXVlc3RbbWV0aG9kXShhLCBiKTtcbiAgfTtcbn0pO1xuXG4vLyBQcm94eSBhbGwgcHVibGljIENsaWVudFJlcXVlc3QgcHJvcGVydGllc1xuW1wiYWJvcnRlZFwiLCBcImNvbm5lY3Rpb25cIiwgXCJzb2NrZXRcIl0uZm9yRWFjaChmdW5jdGlvbiAocHJvcGVydHkpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLCBwcm9wZXJ0eSwge1xuICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY3VycmVudFJlcXVlc3RbcHJvcGVydHldOyB9LFxuICB9KTtcbn0pO1xuXG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5fc2FuaXRpemVPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgLy8gRW5zdXJlIGhlYWRlcnMgYXJlIGFsd2F5cyBwcmVzZW50XG4gIGlmICghb3B0aW9ucy5oZWFkZXJzKSB7XG4gICAgb3B0aW9ucy5oZWFkZXJzID0ge307XG4gIH1cblxuICAvLyBTaW5jZSBodHRwLnJlcXVlc3QgdHJlYXRzIGhvc3QgYXMgYW4gYWxpYXMgb2YgaG9zdG5hbWUsXG4gIC8vIGJ1dCB0aGUgdXJsIG1vZHVsZSBpbnRlcnByZXRzIGhvc3QgYXMgaG9zdG5hbWUgcGx1cyBwb3J0LFxuICAvLyBlbGltaW5hdGUgdGhlIGhvc3QgcHJvcGVydHkgdG8gYXZvaWQgY29uZnVzaW9uLlxuICBpZiAob3B0aW9ucy5ob3N0KSB7XG4gICAgLy8gVXNlIGhvc3RuYW1lIGlmIHNldCwgYmVjYXVzZSBpdCBoYXMgcHJlY2VkZW5jZVxuICAgIGlmICghb3B0aW9ucy5ob3N0bmFtZSkge1xuICAgICAgb3B0aW9ucy5ob3N0bmFtZSA9IG9wdGlvbnMuaG9zdDtcbiAgICB9XG4gICAgZGVsZXRlIG9wdGlvbnMuaG9zdDtcbiAgfVxuXG4gIC8vIENvbXBsZXRlIHRoZSBVUkwgb2JqZWN0IHdoZW4gbmVjZXNzYXJ5XG4gIGlmICghb3B0aW9ucy5wYXRobmFtZSAmJiBvcHRpb25zLnBhdGgpIHtcbiAgICB2YXIgc2VhcmNoUG9zID0gb3B0aW9ucy5wYXRoLmluZGV4T2YoXCI/XCIpO1xuICAgIGlmIChzZWFyY2hQb3MgPCAwKSB7XG4gICAgICBvcHRpb25zLnBhdGhuYW1lID0gb3B0aW9ucy5wYXRoO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIG9wdGlvbnMucGF0aG5hbWUgPSBvcHRpb25zLnBhdGguc3Vic3RyaW5nKDAsIHNlYXJjaFBvcyk7XG4gICAgICBvcHRpb25zLnNlYXJjaCA9IG9wdGlvbnMucGF0aC5zdWJzdHJpbmcoc2VhcmNoUG9zKTtcbiAgICB9XG4gIH1cbn07XG5cblxuLy8gRXhlY3V0ZXMgdGhlIG5leHQgbmF0aXZlIHJlcXVlc3QgKGluaXRpYWwgb3IgcmVkaXJlY3QpXG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5fcGVyZm9ybVJlcXVlc3QgPSBmdW5jdGlvbiAoKSB7XG4gIC8vIExvYWQgdGhlIG5hdGl2ZSBwcm90b2NvbFxuICB2YXIgcHJvdG9jb2wgPSB0aGlzLl9vcHRpb25zLnByb3RvY29sO1xuICB2YXIgbmF0aXZlUHJvdG9jb2wgPSB0aGlzLl9vcHRpb25zLm5hdGl2ZVByb3RvY29sc1twcm90b2NvbF07XG4gIGlmICghbmF0aXZlUHJvdG9jb2wpIHtcbiAgICB0aGlzLmVtaXQoXCJlcnJvclwiLCBuZXcgVHlwZUVycm9yKFwiVW5zdXBwb3J0ZWQgcHJvdG9jb2wgXCIgKyBwcm90b2NvbCkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIElmIHNwZWNpZmllZCwgdXNlIHRoZSBhZ2VudCBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm90b2NvbFxuICAvLyAoSFRUUCBhbmQgSFRUUFMgdXNlIGRpZmZlcmVudCB0eXBlcyBvZiBhZ2VudHMpXG4gIGlmICh0aGlzLl9vcHRpb25zLmFnZW50cykge1xuICAgIHZhciBzY2hlbWUgPSBwcm90b2NvbC5zdWJzdHIoMCwgcHJvdG9jb2wubGVuZ3RoIC0gMSk7XG4gICAgdGhpcy5fb3B0aW9ucy5hZ2VudCA9IHRoaXMuX29wdGlvbnMuYWdlbnRzW3NjaGVtZV07XG4gIH1cblxuICAvLyBDcmVhdGUgdGhlIG5hdGl2ZSByZXF1ZXN0XG4gIHZhciByZXF1ZXN0ID0gdGhpcy5fY3VycmVudFJlcXVlc3QgPVxuICAgICAgICBuYXRpdmVQcm90b2NvbC5yZXF1ZXN0KHRoaXMuX29wdGlvbnMsIHRoaXMuX29uTmF0aXZlUmVzcG9uc2UpO1xuICB0aGlzLl9jdXJyZW50VXJsID0gdXJsLmZvcm1hdCh0aGlzLl9vcHRpb25zKTtcblxuICAvLyBTZXQgdXAgZXZlbnQgaGFuZGxlcnNcbiAgcmVxdWVzdC5fcmVkaXJlY3RhYmxlID0gdGhpcztcbiAgZm9yICh2YXIgZSA9IDA7IGUgPCBldmVudHMubGVuZ3RoOyBlKyspIHtcbiAgICByZXF1ZXN0Lm9uKGV2ZW50c1tlXSwgZXZlbnRIYW5kbGVyc1tldmVudHNbZV1dKTtcbiAgfVxuXG4gIC8vIEVuZCBhIHJlZGlyZWN0ZWQgcmVxdWVzdFxuICAvLyAoVGhlIGZpcnN0IHJlcXVlc3QgbXVzdCBiZSBlbmRlZCBleHBsaWNpdGx5IHdpdGggUmVkaXJlY3RhYmxlUmVxdWVzdCNlbmQpXG4gIGlmICh0aGlzLl9pc1JlZGlyZWN0KSB7XG4gICAgLy8gV3JpdGUgdGhlIHJlcXVlc3QgZW50aXR5IGFuZCBlbmQuXG4gICAgdmFyIGkgPSAwO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgYnVmZmVycyA9IHRoaXMuX3JlcXVlc3RCb2R5QnVmZmVycztcbiAgICAoZnVuY3Rpb24gd3JpdGVOZXh0KGVycm9yKSB7XG4gICAgICAvLyBPbmx5IHdyaXRlIGlmIHRoaXMgcmVxdWVzdCBoYXMgbm90IGJlZW4gcmVkaXJlY3RlZCB5ZXRcbiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICBpZiAocmVxdWVzdCA9PT0gc2VsZi5fY3VycmVudFJlcXVlc3QpIHtcbiAgICAgICAgLy8gUmVwb3J0IGFueSB3cml0ZSBlcnJvcnNcbiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovXG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIHNlbGYuZW1pdChcImVycm9yXCIsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXcml0ZSB0aGUgbmV4dCBidWZmZXIgaWYgdGhlcmUgYXJlIHN0aWxsIGxlZnRcbiAgICAgICAgZWxzZSBpZiAoaSA8IGJ1ZmZlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIGJ1ZmZlciA9IGJ1ZmZlcnNbaSsrXTtcbiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqL1xuICAgICAgICAgIGlmICghcmVxdWVzdC5maW5pc2hlZCkge1xuICAgICAgICAgICAgcmVxdWVzdC53cml0ZShidWZmZXIuZGF0YSwgYnVmZmVyLmVuY29kaW5nLCB3cml0ZU5leHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBFbmQgdGhlIHJlcXVlc3QgaWYgYGVuZGAgaGFzIGJlZW4gY2FsbGVkIG9uIHVzXG4gICAgICAgIGVsc2UgaWYgKHNlbGYuX2VuZGVkKSB7XG4gICAgICAgICAgcmVxdWVzdC5lbmQoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0oKSk7XG4gIH1cbn07XG5cbi8vIFByb2Nlc3NlcyBhIHJlc3BvbnNlIGZyb20gdGhlIGN1cnJlbnQgbmF0aXZlIHJlcXVlc3RcblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLl9wcm9jZXNzUmVzcG9uc2UgPSBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgLy8gU3RvcmUgdGhlIHJlZGlyZWN0ZWQgcmVzcG9uc2VcbiAgdmFyIHN0YXR1c0NvZGUgPSByZXNwb25zZS5zdGF0dXNDb2RlO1xuICBpZiAodGhpcy5fb3B0aW9ucy50cmFja1JlZGlyZWN0cykge1xuICAgIHRoaXMuX3JlZGlyZWN0cy5wdXNoKHtcbiAgICAgIHVybDogdGhpcy5fY3VycmVudFVybCxcbiAgICAgIGhlYWRlcnM6IHJlc3BvbnNlLmhlYWRlcnMsXG4gICAgICBzdGF0dXNDb2RlOiBzdGF0dXNDb2RlLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gUkZDNzIzMcKnNi40OiBUaGUgM3h4IChSZWRpcmVjdGlvbikgY2xhc3Mgb2Ygc3RhdHVzIGNvZGUgaW5kaWNhdGVzXG4gIC8vIHRoYXQgZnVydGhlciBhY3Rpb24gbmVlZHMgdG8gYmUgdGFrZW4gYnkgdGhlIHVzZXIgYWdlbnQgaW4gb3JkZXIgdG9cbiAgLy8gZnVsZmlsbCB0aGUgcmVxdWVzdC4gSWYgYSBMb2NhdGlvbiBoZWFkZXIgZmllbGQgaXMgcHJvdmlkZWQsXG4gIC8vIHRoZSB1c2VyIGFnZW50IE1BWSBhdXRvbWF0aWNhbGx5IHJlZGlyZWN0IGl0cyByZXF1ZXN0IHRvIHRoZSBVUklcbiAgLy8gcmVmZXJlbmNlZCBieSB0aGUgTG9jYXRpb24gZmllbGQgdmFsdWUsXG4gIC8vIGV2ZW4gaWYgdGhlIHNwZWNpZmljIHN0YXR1cyBjb2RlIGlzIG5vdCB1bmRlcnN0b29kLlxuICB2YXIgbG9jYXRpb24gPSByZXNwb25zZS5oZWFkZXJzLmxvY2F0aW9uO1xuICBpZiAobG9jYXRpb24gJiYgdGhpcy5fb3B0aW9ucy5mb2xsb3dSZWRpcmVjdHMgIT09IGZhbHNlICYmXG4gICAgICBzdGF0dXNDb2RlID49IDMwMCAmJiBzdGF0dXNDb2RlIDwgNDAwKSB7XG4gICAgLy8gQWJvcnQgdGhlIGN1cnJlbnQgcmVxdWVzdFxuICAgIGFib3J0UmVxdWVzdCh0aGlzLl9jdXJyZW50UmVxdWVzdCk7XG4gICAgLy8gRGlzY2FyZCB0aGUgcmVtYWluZGVyIG9mIHRoZSByZXNwb25zZSB0byBhdm9pZCB3YWl0aW5nIGZvciBkYXRhXG4gICAgcmVzcG9uc2UuZGVzdHJveSgpO1xuXG4gICAgLy8gUkZDNzIzMcKnNi40OiBBIGNsaWVudCBTSE9VTEQgZGV0ZWN0IGFuZCBpbnRlcnZlbmVcbiAgICAvLyBpbiBjeWNsaWNhbCByZWRpcmVjdGlvbnMgKGkuZS4sIFwiaW5maW5pdGVcIiByZWRpcmVjdGlvbiBsb29wcykuXG4gICAgaWYgKCsrdGhpcy5fcmVkaXJlY3RDb3VudCA+IHRoaXMuX29wdGlvbnMubWF4UmVkaXJlY3RzKSB7XG4gICAgICB0aGlzLmVtaXQoXCJlcnJvclwiLCBuZXcgVG9vTWFueVJlZGlyZWN0c0Vycm9yKCkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJGQzcyMzHCpzYuNDogQXV0b21hdGljIHJlZGlyZWN0aW9uIG5lZWRzIHRvIGRvbmUgd2l0aFxuICAgIC8vIGNhcmUgZm9yIG1ldGhvZHMgbm90IGtub3duIHRvIGJlIHNhZmUsIFvigKZdXG4gICAgLy8gUkZDNzIzMcKnNi40LjLigJMzOiBGb3IgaGlzdG9yaWNhbCByZWFzb25zLCBhIHVzZXIgYWdlbnQgTUFZIGNoYW5nZVxuICAgIC8vIHRoZSByZXF1ZXN0IG1ldGhvZCBmcm9tIFBPU1QgdG8gR0VUIGZvciB0aGUgc3Vic2VxdWVudCByZXF1ZXN0LlxuICAgIGlmICgoc3RhdHVzQ29kZSA9PT0gMzAxIHx8IHN0YXR1c0NvZGUgPT09IDMwMikgJiYgdGhpcy5fb3B0aW9ucy5tZXRob2QgPT09IFwiUE9TVFwiIHx8XG4gICAgICAgIC8vIFJGQzcyMzHCpzYuNC40OiBUaGUgMzAzIChTZWUgT3RoZXIpIHN0YXR1cyBjb2RlIGluZGljYXRlcyB0aGF0XG4gICAgICAgIC8vIHRoZSBzZXJ2ZXIgaXMgcmVkaXJlY3RpbmcgdGhlIHVzZXIgYWdlbnQgdG8gYSBkaWZmZXJlbnQgcmVzb3VyY2UgW+KApl1cbiAgICAgICAgLy8gQSB1c2VyIGFnZW50IGNhbiBwZXJmb3JtIGEgcmV0cmlldmFsIHJlcXVlc3QgdGFyZ2V0aW5nIHRoYXQgVVJJXG4gICAgICAgIC8vIChhIEdFVCBvciBIRUFEIHJlcXVlc3QgaWYgdXNpbmcgSFRUUCkgW+KApl1cbiAgICAgICAgKHN0YXR1c0NvZGUgPT09IDMwMykgJiYgIS9eKD86R0VUfEhFQUQpJC8udGVzdCh0aGlzLl9vcHRpb25zLm1ldGhvZCkpIHtcbiAgICAgIHRoaXMuX29wdGlvbnMubWV0aG9kID0gXCJHRVRcIjtcbiAgICAgIC8vIERyb3AgYSBwb3NzaWJsZSBlbnRpdHkgYW5kIGhlYWRlcnMgcmVsYXRlZCB0byBpdFxuICAgICAgdGhpcy5fcmVxdWVzdEJvZHlCdWZmZXJzID0gW107XG4gICAgICByZW1vdmVNYXRjaGluZ0hlYWRlcnMoL15jb250ZW50LS9pLCB0aGlzLl9vcHRpb25zLmhlYWRlcnMpO1xuICAgIH1cblxuICAgIC8vIERyb3AgdGhlIEhvc3QgaGVhZGVyLCBhcyB0aGUgcmVkaXJlY3QgbWlnaHQgbGVhZCB0byBhIGRpZmZlcmVudCBob3N0XG4gICAgdmFyIGN1cnJlbnRIb3N0SGVhZGVyID0gcmVtb3ZlTWF0Y2hpbmdIZWFkZXJzKC9eaG9zdCQvaSwgdGhpcy5fb3B0aW9ucy5oZWFkZXJzKTtcblxuICAgIC8vIElmIHRoZSByZWRpcmVjdCBpcyByZWxhdGl2ZSwgY2Fycnkgb3ZlciB0aGUgaG9zdCBvZiB0aGUgbGFzdCByZXF1ZXN0XG4gICAgdmFyIGN1cnJlbnRVcmxQYXJ0cyA9IHVybC5wYXJzZSh0aGlzLl9jdXJyZW50VXJsKTtcbiAgICB2YXIgY3VycmVudEhvc3QgPSBjdXJyZW50SG9zdEhlYWRlciB8fCBjdXJyZW50VXJsUGFydHMuaG9zdDtcbiAgICB2YXIgY3VycmVudFVybCA9IC9eXFx3KzovLnRlc3QobG9jYXRpb24pID8gdGhpcy5fY3VycmVudFVybCA6XG4gICAgICB1cmwuZm9ybWF0KE9iamVjdC5hc3NpZ24oY3VycmVudFVybFBhcnRzLCB7IGhvc3Q6IGN1cnJlbnRIb3N0IH0pKTtcblxuICAgIC8vIERldGVybWluZSB0aGUgVVJMIG9mIHRoZSByZWRpcmVjdGlvblxuICAgIHZhciByZWRpcmVjdFVybDtcbiAgICB0cnkge1xuICAgICAgcmVkaXJlY3RVcmwgPSB1cmwucmVzb2x2ZShjdXJyZW50VXJsLCBsb2NhdGlvbik7XG4gICAgfVxuICAgIGNhdGNoIChjYXVzZSkge1xuICAgICAgdGhpcy5lbWl0KFwiZXJyb3JcIiwgbmV3IFJlZGlyZWN0aW9uRXJyb3IoY2F1c2UpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgdGhlIHJlZGlyZWN0ZWQgcmVxdWVzdFxuICAgIGRlYnVnKFwicmVkaXJlY3RpbmcgdG9cIiwgcmVkaXJlY3RVcmwpO1xuICAgIHRoaXMuX2lzUmVkaXJlY3QgPSB0cnVlO1xuICAgIHZhciByZWRpcmVjdFVybFBhcnRzID0gdXJsLnBhcnNlKHJlZGlyZWN0VXJsKTtcbiAgICBPYmplY3QuYXNzaWduKHRoaXMuX29wdGlvbnMsIHJlZGlyZWN0VXJsUGFydHMpO1xuXG4gICAgLy8gRHJvcCB0aGUgQXV0aG9yaXphdGlvbiBoZWFkZXIgaWYgcmVkaXJlY3RpbmcgdG8gYW5vdGhlciBkb21haW5cbiAgICBpZiAoIShyZWRpcmVjdFVybFBhcnRzLmhvc3QgPT09IGN1cnJlbnRIb3N0IHx8IGlzU3ViZG9tYWluT2YocmVkaXJlY3RVcmxQYXJ0cy5ob3N0LCBjdXJyZW50SG9zdCkpKSB7XG4gICAgICByZW1vdmVNYXRjaGluZ0hlYWRlcnMoL15hdXRob3JpemF0aW9uJC9pLCB0aGlzLl9vcHRpb25zLmhlYWRlcnMpO1xuICAgIH1cblxuICAgIC8vIEV2YWx1YXRlIHRoZSBiZWZvcmVSZWRpcmVjdCBjYWxsYmFja1xuICAgIGlmICh0eXBlb2YgdGhpcy5fb3B0aW9ucy5iZWZvcmVSZWRpcmVjdCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICB2YXIgcmVzcG9uc2VEZXRhaWxzID0geyBoZWFkZXJzOiByZXNwb25zZS5oZWFkZXJzIH07XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLl9vcHRpb25zLmJlZm9yZVJlZGlyZWN0LmNhbGwobnVsbCwgdGhpcy5fb3B0aW9ucywgcmVzcG9uc2VEZXRhaWxzKTtcbiAgICAgIH1cbiAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhpcy5lbWl0KFwiZXJyb3JcIiwgZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5fc2FuaXRpemVPcHRpb25zKHRoaXMuX29wdGlvbnMpO1xuICAgIH1cblxuICAgIC8vIFBlcmZvcm0gdGhlIHJlZGlyZWN0ZWQgcmVxdWVzdFxuICAgIHRyeSB7XG4gICAgICB0aGlzLl9wZXJmb3JtUmVxdWVzdCgpO1xuICAgIH1cbiAgICBjYXRjaCAoY2F1c2UpIHtcbiAgICAgIHRoaXMuZW1pdChcImVycm9yXCIsIG5ldyBSZWRpcmVjdGlvbkVycm9yKGNhdXNlKSk7XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIC8vIFRoZSByZXNwb25zZSBpcyBub3QgYSByZWRpcmVjdDsgcmV0dXJuIGl0IGFzLWlzXG4gICAgcmVzcG9uc2UucmVzcG9uc2VVcmwgPSB0aGlzLl9jdXJyZW50VXJsO1xuICAgIHJlc3BvbnNlLnJlZGlyZWN0cyA9IHRoaXMuX3JlZGlyZWN0cztcbiAgICB0aGlzLmVtaXQoXCJyZXNwb25zZVwiLCByZXNwb25zZSk7XG5cbiAgICAvLyBDbGVhbiB1cFxuICAgIHRoaXMuX3JlcXVlc3RCb2R5QnVmZmVycyA9IFtdO1xuICB9XG59O1xuXG4vLyBXcmFwcyB0aGUga2V5L3ZhbHVlIG9iamVjdCBvZiBwcm90b2NvbHMgd2l0aCByZWRpcmVjdCBmdW5jdGlvbmFsaXR5XG5mdW5jdGlvbiB3cmFwKHByb3RvY29scykge1xuICAvLyBEZWZhdWx0IHNldHRpbmdzXG4gIHZhciBleHBvcnRzID0ge1xuICAgIG1heFJlZGlyZWN0czogMjEsXG4gICAgbWF4Qm9keUxlbmd0aDogMTAgKiAxMDI0ICogMTAyNCxcbiAgfTtcblxuICAvLyBXcmFwIGVhY2ggcHJvdG9jb2xcbiAgdmFyIG5hdGl2ZVByb3RvY29scyA9IHt9O1xuICBPYmplY3Qua2V5cyhwcm90b2NvbHMpLmZvckVhY2goZnVuY3Rpb24gKHNjaGVtZSkge1xuICAgIHZhciBwcm90b2NvbCA9IHNjaGVtZSArIFwiOlwiO1xuICAgIHZhciBuYXRpdmVQcm90b2NvbCA9IG5hdGl2ZVByb3RvY29sc1twcm90b2NvbF0gPSBwcm90b2NvbHNbc2NoZW1lXTtcbiAgICB2YXIgd3JhcHBlZFByb3RvY29sID0gZXhwb3J0c1tzY2hlbWVdID0gT2JqZWN0LmNyZWF0ZShuYXRpdmVQcm90b2NvbCk7XG5cbiAgICAvLyBFeGVjdXRlcyBhIHJlcXVlc3QsIGZvbGxvd2luZyByZWRpcmVjdHNcbiAgICBmdW5jdGlvbiByZXF1ZXN0KGlucHV0LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgLy8gUGFyc2UgcGFyYW1ldGVyc1xuICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICB2YXIgdXJsU3RyID0gaW5wdXQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaW5wdXQgPSB1cmxUb09wdGlvbnMobmV3IFVSTCh1cmxTdHIpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgICAgICBpbnB1dCA9IHVybC5wYXJzZSh1cmxTdHIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChVUkwgJiYgKGlucHV0IGluc3RhbmNlb2YgVVJMKSkge1xuICAgICAgICBpbnB1dCA9IHVybFRvT3B0aW9ucyhpbnB1dCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgICAgICBvcHRpb25zID0gaW5wdXQ7XG4gICAgICAgIGlucHV0ID0geyBwcm90b2NvbDogcHJvdG9jb2wgfTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgICAgb3B0aW9ucyA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBkZWZhdWx0c1xuICAgICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICBtYXhSZWRpcmVjdHM6IGV4cG9ydHMubWF4UmVkaXJlY3RzLFxuICAgICAgICBtYXhCb2R5TGVuZ3RoOiBleHBvcnRzLm1heEJvZHlMZW5ndGgsXG4gICAgICB9LCBpbnB1dCwgb3B0aW9ucyk7XG4gICAgICBvcHRpb25zLm5hdGl2ZVByb3RvY29scyA9IG5hdGl2ZVByb3RvY29scztcblxuICAgICAgYXNzZXJ0LmVxdWFsKG9wdGlvbnMucHJvdG9jb2wsIHByb3RvY29sLCBcInByb3RvY29sIG1pc21hdGNoXCIpO1xuICAgICAgZGVidWcoXCJvcHRpb25zXCIsIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIG5ldyBSZWRpcmVjdGFibGVSZXF1ZXN0KG9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICAvLyBFeGVjdXRlcyBhIEdFVCByZXF1ZXN0LCBmb2xsb3dpbmcgcmVkaXJlY3RzXG4gICAgZnVuY3Rpb24gZ2V0KGlucHV0LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgICAgdmFyIHdyYXBwZWRSZXF1ZXN0ID0gd3JhcHBlZFByb3RvY29sLnJlcXVlc3QoaW5wdXQsIG9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICAgIHdyYXBwZWRSZXF1ZXN0LmVuZCgpO1xuICAgICAgcmV0dXJuIHdyYXBwZWRSZXF1ZXN0O1xuICAgIH1cblxuICAgIC8vIEV4cG9zZSB0aGUgcHJvcGVydGllcyBvbiB0aGUgd3JhcHBlZCBwcm90b2NvbFxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHdyYXBwZWRQcm90b2NvbCwge1xuICAgICAgcmVxdWVzdDogeyB2YWx1ZTogcmVxdWVzdCwgY29uZmlndXJhYmxlOiB0cnVlLCBlbnVtZXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9LFxuICAgICAgZ2V0OiB7IHZhbHVlOiBnZXQsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSxcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiBleHBvcnRzO1xufVxuXG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuZnVuY3Rpb24gbm9vcCgpIHsgLyogZW1wdHkgKi8gfVxuXG4vLyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS9ibG9iL21hc3Rlci9saWIvaW50ZXJuYWwvdXJsLmpzXG5mdW5jdGlvbiB1cmxUb09wdGlvbnModXJsT2JqZWN0KSB7XG4gIHZhciBvcHRpb25zID0ge1xuICAgIHByb3RvY29sOiB1cmxPYmplY3QucHJvdG9jb2wsXG4gICAgaG9zdG5hbWU6IHVybE9iamVjdC5ob3N0bmFtZS5zdGFydHNXaXRoKFwiW1wiKSA/XG4gICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgICAgdXJsT2JqZWN0Lmhvc3RuYW1lLnNsaWNlKDEsIC0xKSA6XG4gICAgICB1cmxPYmplY3QuaG9zdG5hbWUsXG4gICAgaGFzaDogdXJsT2JqZWN0Lmhhc2gsXG4gICAgc2VhcmNoOiB1cmxPYmplY3Quc2VhcmNoLFxuICAgIHBhdGhuYW1lOiB1cmxPYmplY3QucGF0aG5hbWUsXG4gICAgcGF0aDogdXJsT2JqZWN0LnBhdGhuYW1lICsgdXJsT2JqZWN0LnNlYXJjaCxcbiAgICBocmVmOiB1cmxPYmplY3QuaHJlZixcbiAgfTtcbiAgaWYgKHVybE9iamVjdC5wb3J0ICE9PSBcIlwiKSB7XG4gICAgb3B0aW9ucy5wb3J0ID0gTnVtYmVyKHVybE9iamVjdC5wb3J0KTtcbiAgfVxuICByZXR1cm4gb3B0aW9ucztcbn1cblxuZnVuY3Rpb24gcmVtb3ZlTWF0Y2hpbmdIZWFkZXJzKHJlZ2V4LCBoZWFkZXJzKSB7XG4gIHZhciBsYXN0VmFsdWU7XG4gIGZvciAodmFyIGhlYWRlciBpbiBoZWFkZXJzKSB7XG4gICAgaWYgKHJlZ2V4LnRlc3QoaGVhZGVyKSkge1xuICAgICAgbGFzdFZhbHVlID0gaGVhZGVyc1toZWFkZXJdO1xuICAgICAgZGVsZXRlIGhlYWRlcnNbaGVhZGVyXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIChsYXN0VmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIGxhc3RWYWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikgP1xuICAgIHVuZGVmaW5lZCA6IFN0cmluZyhsYXN0VmFsdWUpLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRXJyb3JUeXBlKGNvZGUsIGRlZmF1bHRNZXNzYWdlKSB7XG4gIGZ1bmN0aW9uIEN1c3RvbUVycm9yKGNhdXNlKSB7XG4gICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdGhpcy5jb25zdHJ1Y3Rvcik7XG4gICAgaWYgKCFjYXVzZSkge1xuICAgICAgdGhpcy5tZXNzYWdlID0gZGVmYXVsdE1lc3NhZ2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5tZXNzYWdlID0gZGVmYXVsdE1lc3NhZ2UgKyBcIjogXCIgKyBjYXVzZS5tZXNzYWdlO1xuICAgICAgdGhpcy5jYXVzZSA9IGNhdXNlO1xuICAgIH1cbiAgfVxuICBDdXN0b21FcnJvci5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTtcbiAgQ3VzdG9tRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ3VzdG9tRXJyb3I7XG4gIEN1c3RvbUVycm9yLnByb3RvdHlwZS5uYW1lID0gXCJFcnJvciBbXCIgKyBjb2RlICsgXCJdXCI7XG4gIEN1c3RvbUVycm9yLnByb3RvdHlwZS5jb2RlID0gY29kZTtcbiAgcmV0dXJuIEN1c3RvbUVycm9yO1xufVxuXG5mdW5jdGlvbiBhYm9ydFJlcXVlc3QocmVxdWVzdCkge1xuICBmb3IgKHZhciBlID0gMDsgZSA8IGV2ZW50cy5sZW5ndGg7IGUrKykge1xuICAgIHJlcXVlc3QucmVtb3ZlTGlzdGVuZXIoZXZlbnRzW2VdLCBldmVudEhhbmRsZXJzW2V2ZW50c1tlXV0pO1xuICB9XG4gIHJlcXVlc3Qub24oXCJlcnJvclwiLCBub29wKTtcbiAgcmVxdWVzdC5hYm9ydCgpO1xufVxuXG5mdW5jdGlvbiBpc1N1YmRvbWFpbk9mKHN1YmRvbWFpbiwgZG9tYWluKSB7XG4gIGNvbnN0IGRvdCA9IHN1YmRvbWFpbi5sZW5ndGggLSBkb21haW4ubGVuZ3RoIC0gMTtcbiAgcmV0dXJuIGRvdCA+IDAgJiYgc3ViZG9tYWluW2RvdF0gPT09IFwiLlwiICYmIHN1YmRvbWFpbi5lbmRzV2l0aChkb21haW4pO1xufVxuXG4vLyBFeHBvcnRzXG5tb2R1bGUuZXhwb3J0cyA9IHdyYXAoeyBodHRwOiBodHRwLCBodHRwczogaHR0cHMgfSk7XG5tb2R1bGUuZXhwb3J0cy53cmFwID0gd3JhcDtcbiJdfQ==